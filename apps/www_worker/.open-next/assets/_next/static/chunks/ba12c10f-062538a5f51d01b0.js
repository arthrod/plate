"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[18803],{48554:(e,t,a)=>{a.d(t,{Df:()=>tA,G5:()=>t1,gM:()=>tX,k7:()=>th,rL:()=>t2,zX:()=>tJ});var o,r,n,l,i,s,u,p,d,c,m,v,f=a(54661),h=a(98162),g=a(70896),y=a(21688),b=a(24319),I=a(52056),w=a(13634),T=a(40459),x=Object.defineProperty,z="AI_InvalidArgumentError",k=`vercel.ai.error.${z}`,C=Symbol.for(k),E=class extends h.bD{constructor({parameter:e,value:t,message:a}){super({name:z,message:`Invalid argument for parameter ${e}: ${a}`}),this[o]=!0,this.parameter=e,this.value=t}static isInstance(e){return h.bD.hasMarker(e,k)}};o=C;Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");h.bD;var S="AI_InvalidToolApprovalError",R=`vercel.ai.error.${S}`,M=Symbol.for(R),N=class extends h.bD{constructor({approvalId:e}){super({name:S,message:`Tool approval response references unknown approvalId: "${e}". No matching tool-approval-request found in message history.`}),this[r]=!0,this.approvalId=e}static isInstance(e){return h.bD.hasMarker(e,R)}};r=M;var _="AI_InvalidToolInputError",O=`vercel.ai.error.${_}`,A=Symbol.for(O),q=class extends h.bD{constructor({toolInput:e,toolName:t,cause:a,message:o=`Invalid input for tool ${t}: ${(0,h.u1)(a)}`}){super({name:_,message:o,cause:a}),this[n]=!0,this.toolInput=e,this.toolName=t}static isInstance(e){return h.bD.hasMarker(e,O)}};n=A;var j="AI_ToolCallNotFoundForApprovalError",D=`vercel.ai.error.${j}`,P=Symbol.for(D),$=class extends h.bD{constructor({toolCallId:e,approvalId:t}){super({name:j,message:`Tool call "${e}" not found for approval request "${t}".`}),this[l]=!0,this.toolCallId=e,this.approvalId=t}static isInstance(e){return h.bD.hasMarker(e,D)}};l=P;var U="AI_MissingToolResultsError",F=`vercel.ai.error.${U}`,J=Symbol.for(F),L=class extends h.bD{constructor({toolCallIds:e}){super({name:U,message:`Tool result${e.length>1?"s are":" is"} missing for tool call${e.length>1?"s":""} ${e.join(", ")}.`}),this[i]=!0,this.toolCallIds=e}static isInstance(e){return h.bD.hasMarker(e,F)}};i=J;Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");h.bD;var B="AI_NoObjectGeneratedError",W=`vercel.ai.error.${B}`,G=Symbol.for(W),V=class extends h.bD{constructor({message:e="No object generated.",cause:t,text:a,response:o,usage:r,finishReason:n}){super({name:B,message:e,cause:t}),this[s]=!0,this.text=a,this.response=o,this.usage=r,this.finishReason=n}static isInstance(e){return h.bD.hasMarker(e,W)}};s=G;var Y="AI_NoOutputGeneratedError",K=`vercel.ai.error.${Y}`,Z=Symbol.for(K),H=class extends h.bD{constructor({message:e="No output generated.",cause:t}={}){super({name:Y,message:e,cause:t}),this[u]=!0}static isInstance(e){return h.bD.hasMarker(e,K)}};u=Z;Symbol.for("vercel.ai.error.AI_NoSpeechGeneratedError");h.bD;Symbol.for("vercel.ai.error.AI_NoTranscriptGeneratedError");h.bD;Symbol.for("vercel.ai.error.AI_NoVideoGeneratedError");h.bD;var Q="AI_NoSuchToolError",X=`vercel.ai.error.${Q}`,ee=Symbol.for(X),et=class extends h.bD{constructor({toolName:e,availableTools:t,message:a=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:Q,message:a}),this[p]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return h.bD.hasMarker(e,X)}};p=ee;var ea="AI_ToolCallRepairError",eo=`vercel.ai.error.${ea}`,er=Symbol.for(eo),en=class extends h.bD{constructor({cause:e,originalError:t,message:a=`Error repairing tool call: ${(0,h.u1)(e)}`}){super({name:ea,message:a,cause:e}),this[d]=!0,this.originalError=t}static isInstance(e){return h.bD.hasMarker(e,eo)}};d=er;var el=class extends h.bD{constructor(e){super({name:"AI_UnsupportedModelVersionError",message:`Unsupported model version ${e.version} for provider "${e.provider}" and model "${e.modelId}". AI SDK 5 only supports models that implement specification version "v2".`}),this.version=e.version,this.provider=e.provider,this.modelId=e.modelId}},ei="AI_UIMessageStreamError",es=`vercel.ai.error.${ei}`,eu=Symbol.for(es),ep=class extends h.bD{constructor({chunkType:e,chunkId:t,message:a}){super({name:ei,message:a}),this[c]=!0,this.chunkType=e,this.chunkId=t}static isInstance(e){return h.bD.hasMarker(e,es)}};c=eu;Symbol.for("vercel.ai.error.AI_InvalidDataContentError");h.bD;var ed="AI_InvalidMessageRoleError",ec=`vercel.ai.error.${ed}`,em=Symbol.for(ec),ev=class extends h.bD{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:ed,message:t}),this[m]=!0,this.role=e}static isInstance(e){return h.bD.hasMarker(e,ec)}};m=em;Symbol.for("vercel.ai.error.AI_MessageConversionError");h.bD;var ef="AI_RetryError",eh=`vercel.ai.error.${ef}`,eg=Symbol.for(eh),ey=class extends h.bD{constructor({message:e,reason:t,errors:a}){super({name:ef,message:e}),this[v]=!0,this.reason=t,this.errors=a,this.lastError=a[a.length-1]}static isInstance(e){return h.bD.hasMarker(e,eh)}};v=eg;var eb=!1,eI=e=>{if(0===e.warnings.length)return;let t=globalThis.AI_SDK_LOG_WARNINGS;if(!1!==t){if("function"==typeof t)return void t(e);for(let t of(eb||(eb=!0,console.info("AI SDK Warning System: To turn off warning logging, set the AI_SDK_LOG_WARNINGS global to false.")),e.warnings))console.warn(function({warning:e,provider:t,model:a}){let o=`AI SDK Warning (${t} / ${a}):`;switch(e.type){case"unsupported":{let t=`${o} The feature "${e.feature}" is not supported.`;return e.details&&(t+=` ${e.details}`),t}case"compatibility":{let t=`${o} The feature "${e.feature}" is used in a compatibility mode.`;return e.details&&(t+=` ${e.details}`),t}case"other":return`${o} ${e.message}`;default:return`${o} ${JSON.stringify(e,null,2)}`}}({warning:t,provider:e.provider,model:e.model}))}};function ew(e){return{unified:"unknown"===e?"other":e,raw:void 0}}function eT(e){return{inputTokens:{total:e.inputTokens,noCache:void 0,cacheRead:e.cachedInputTokens,cacheWrite:void 0},outputTokens:{total:e.outputTokens,text:void 0,reasoning:e.reasoningTokens}}}function ex(e){var t;if("string"!=typeof e){if("v3"!==e.specificationVersion&&"v2"!==e.specificationVersion)throw new el({version:e.specificationVersion,provider:e.provider,modelId:e.modelId});return"v3"===e.specificationVersion?e:(!function({provider:e,modelId:t}){eI({warnings:[{type:"compatibility",feature:"specificationVersion",details:"Using v2 specification compatibility mode. Some features may not be available."}],provider:e,model:t})}({provider:e.provider,modelId:e.modelId}),new Proxy(e,{get(e,t){switch(t){case"specificationVersion":return"v3";case"doGenerate":return async(...t)=>{let a=await e.doGenerate(...t);return{...a,finishReason:ew(a.finishReason),usage:eT(a.usage)}};case"doStream":return async(...t)=>{let a=await e.doStream(...t);return{...a,stream:a.stream.pipeThrough(new TransformStream({transform(e,t){"finish"===e.type?t.enqueue({...e,finishReason:ew(e.finishReason),usage:eT(e.usage)}):t.enqueue(e)}}))}};default:return e[t]}}}))}return(null!=(t=globalThis.AI_SDK_DEFAULT_PROVIDER)?t:g.JS).languageModel(e)}function ez(e){if(null!=e)return"number"==typeof e?e:e.totalMs}function ek(e){if(null!=e&&"number"!=typeof e)return e.stepMs}var eC=[{mediaType:"image/gif",bytesPrefix:[71,73,70]},{mediaType:"image/png",bytesPrefix:[137,80,78,71]},{mediaType:"image/jpeg",bytesPrefix:[255,216]},{mediaType:"image/webp",bytesPrefix:[82,73,70,70,null,null,null,null,87,69,66,80]},{mediaType:"image/bmp",bytesPrefix:[66,77]},{mediaType:"image/tiff",bytesPrefix:[73,73,42,0]},{mediaType:"image/tiff",bytesPrefix:[77,77,0,42]},{mediaType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102]},{mediaType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99]}],eE="6.0.73",eS=async({url:e})=>{var t;let a=e.toString();try{let e=await fetch(a,{headers:(0,f.WZ)({},`ai-sdk/${eE}`,(0,f.G1)())});if(!e.ok)throw new f.nV({url:a,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mediaType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(f.nV.isInstance(e))throw e;throw new f.nV({url:a,cause:e})}},eR=y.z.union([y.z.string(),y.z.instanceof(Uint8Array),y.z.instanceof(ArrayBuffer),y.z.custom(e=>{var t,a;return null!=(a=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&a},{message:"Must be a Buffer"})]);function eM(e){if(e instanceof Uint8Array)return{data:e,mediaType:void 0};if(e instanceof ArrayBuffer)return{data:new Uint8Array(e),mediaType:void 0};if("string"==typeof e)try{e=new URL(e)}catch(e){}if(e instanceof URL&&"data:"===e.protocol){let{mediaType:t,base64Content:a}=function(e){try{let[t,a]=e.split(",");return{mediaType:t.split(";")[0].split(":")[1],base64Content:a}}catch(e){return{mediaType:void 0,base64Content:void 0}}}(e.toString());if(null==t||null==a)throw new h.bD({name:"InvalidDataContentError",message:`Invalid data URL format in content ${e.toString()}`});return{data:a,mediaType:t}}return{data:e,mediaType:void 0}}function eN(e){return void 0===e?[]:Array.isArray(e)?e:[e]}async function e_({prompt:e,supportedUrls:t,download:a=((e=eS)=>t=>Promise.all(t.map(async t=>t.isUrlSupportedByModel?null:e(t))))()}){let o=await eO(e.messages,a,t),r=new Map;for(let t of e.messages)if("assistant"===t.role&&Array.isArray(t.content))for(let e of t.content)"tool-approval-request"===e.type&&"approvalId"in e&&"toolCallId"in e&&r.set(e.approvalId,e.toolCallId);let n=new Set;for(let t of e.messages)if("tool"===t.role){for(let e of t.content)if("tool-approval-response"===e.type){let t=r.get(e.approvalId);t&&n.add(t)}}let l=[...null!=e.system?"string"==typeof e.system?[{role:"system",content:e.system}]:eN(e.system).map(e=>({role:"system",content:e.content,providerOptions:e.providerOptions})):[],...e.messages.map(e=>(function({message:e,downloadedAssets:t}){let a=e.role;switch(a){case"system":return{role:"system",content:e.content,providerOptions:e.providerOptions};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"user",content:e.content.map(e=>(function(e,t){var a;let o;if("text"===e.type)return{type:"text",text:e.text,providerOptions:e.providerOptions};let r=e.type;switch(r){case"image":o=e.image;break;case"file":o=e.data;break;default:throw Error(`Unsupported part type: ${r}`)}let{data:n,mediaType:l}=eM(o),i=null!=l?l:e.mediaType,s=n;if(s instanceof URL){let e=t[s.toString()];e&&(s=e.data,null!=i||(i=e.mediaType))}switch(r){case"image":return(s instanceof Uint8Array||"string"==typeof s)&&(i=null!=(a=function({data:e,signatures:t}){let a,o,r="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?(o=(127&(a="string"==typeof e?(0,f.Z9)(e):e)[6])<<21|(127&a[7])<<14|(127&a[8])<<7|127&a[9],a.slice(o+10)):e,n="string"==typeof r?(0,f.Z9)(r.substring(0,Math.min(r.length,24))):r;for(let e of t)if(n.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>null===e||n[t]===e))return e.mediaType}({data:s,signatures:eC}))?a:i),{type:"file",mediaType:null!=i?i:"image/*",filename:void 0,data:s,providerOptions:e.providerOptions};case"file":if(null==i)throw Error("Media type is missing for file part");return{type:"file",mediaType:i,filename:e.filename,data:s,providerOptions:e.providerOptions}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerOptions:e.providerOptions};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerOptions:e.providerOptions};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text||null!=e.providerOptions).filter(e=>"tool-approval-request"!==e.type).map(e=>{let t=e.providerOptions;switch(e.type){case"file":{let{data:a,mediaType:o}=eM(e.data);return{type:"file",data:a,filename:e.filename,mediaType:null!=o?o:e.mediaType,providerOptions:t}}case"reasoning":return{type:"reasoning",text:e.text,providerOptions:t};case"text":return{type:"text",text:e.text,providerOptions:t};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,providerExecuted:e.providerExecuted,providerOptions:t};case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:eA(e.output),providerOptions:t}}}),providerOptions:e.providerOptions};case"tool":return{role:"tool",content:e.content.filter(e=>"tool-approval-response"!==e.type||e.providerExecuted).map(e=>{switch(e.type){case"tool-result":return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,output:eA(e.output),providerOptions:e.providerOptions};case"tool-approval-response":return{type:"tool-approval-response",approvalId:e.approvalId,approved:e.approved,reason:e.reason}}}),providerOptions:e.providerOptions};default:throw new ev({role:a})}})({message:e,downloadedAssets:o}))],i=[];for(let e of l){if("tool"!==e.role){i.push(e);continue}let t=i.at(-1);(null==t?void 0:t.role)==="tool"?t.content.push(...e.content):i.push(e)}let s=new Set;for(let e of i)switch(e.role){case"assistant":for(let t of e.content)"tool-call"!==t.type||t.providerExecuted||s.add(t.toolCallId);break;case"tool":for(let t of e.content)"tool-result"===t.type&&s.delete(t.toolCallId);break;case"user":case"system":for(let e of n)s.delete(e);if(s.size>0)throw new L({toolCallIds:Array.from(s)})}for(let e of n)s.delete(e);if(s.size>0)throw new L({toolCallIds:Array.from(s)});return i.filter(e=>"tool"!==e.role||e.content.length>0)}async function eO(e,t,a){let o=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).map(e=>{var t;let a=null!=(t=e.mediaType)?t:"image"===e.type?"image/*":void 0,o="image"===e.type?e.image:e.data;if("string"==typeof o)try{o=new URL(o)}catch(e){}return{mediaType:a,data:o}}).filter(e=>e.data instanceof URL).map(e=>({url:e.data,isUrlSupportedByModel:null!=e.mediaType&&(0,f.qs)({url:e.data.toString(),mediaType:e.mediaType,supportedUrls:a})}));return Object.fromEntries((await t(o)).map((e,t)=>null==e?null:[o[t].url.toString(),{data:e.data,mediaType:e.mediaType}]).filter(e=>null!=e))}function eA(e){return"content"!==e.type?e:{type:"content",value:e.value.map(e=>"media"!==e.type?e:e.mediaType.startsWith("image/")?{type:"image-data",data:e.data,mediaType:e.mediaType}:{type:"file-data",data:e.data,mediaType:e.mediaType})}}async function eq({toolCallId:e,input:t,output:a,tool:o,errorMode:r}){return"text"===r?{type:"error-text",value:(0,h.u1)(a)}:"json"===r?{type:"error-json",value:ej(a)}:(null==o?void 0:o.toModelOutput)?await o.toModelOutput({toolCallId:e,input:t,output:a}):"string"==typeof a?{type:"text",value:a}:{type:"json",value:ej(a)}}function ej(e){return void 0===e?null:e}function eD({maxOutputTokens:e,temperature:t,topP:a,topK:o,presencePenalty:r,frequencyPenalty:n,seed:l,stopSequences:i}){if(null!=e){if(!Number.isInteger(e))throw new E({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be an integer"});if(e<1)throw new E({parameter:"maxOutputTokens",value:e,message:"maxOutputTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new E({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=a&&"number"!=typeof a)throw new E({parameter:"topP",value:a,message:"topP must be a number"});if(null!=o&&"number"!=typeof o)throw new E({parameter:"topK",value:o,message:"topK must be a number"});if(null!=r&&"number"!=typeof r)throw new E({parameter:"presencePenalty",value:r,message:"presencePenalty must be a number"});if(null!=n&&"number"!=typeof n)throw new E({parameter:"frequencyPenalty",value:n,message:"frequencyPenalty must be a number"});if(null!=l&&!Number.isInteger(l))throw new E({parameter:"seed",value:l,message:"seed must be an integer"});return{maxOutputTokens:e,temperature:t,topP:a,topK:o,presencePenalty:r,frequencyPenalty:n,stopSequences:i,seed:l}}async function eP({tools:e,toolChoice:t,activeTools:a}){if(!(null!=e&&Object.keys(e).length>0))return{tools:void 0,toolChoice:void 0};let o=null!=a?Object.entries(e).filter(([e])=>a.includes(e)):Object.entries(e),r=[];for(let[e,t]of o){let a=t.type;switch(a){case void 0:case"dynamic":case"function":r.push({type:"function",name:e,description:t.description,inputSchema:await (0,f.mD)(t.inputSchema).jsonSchema,...null!=t.inputExamples?{inputExamples:t.inputExamples}:{},providerOptions:t.providerOptions,...null!=t.strict?{strict:t.strict}:{}});break;case"provider":r.push({type:"provider",name:e,id:t.id,args:t.args});break;default:throw Error(`Unsupported tool type: ${a}`)}}return{tools:r,toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}}var e$=y.z.lazy(()=>y.z.union([y.z.null(),y.z.string(),y.z.number(),y.z.boolean(),y.z.record(y.z.string(),e$.optional()),y.z.array(e$)])),eU=y.z.record(y.z.string(),y.z.record(y.z.string(),e$.optional())),eF=y.z.object({type:y.z.literal("text"),text:y.z.string(),providerOptions:eU.optional()}),eJ=y.z.object({type:y.z.literal("image"),image:y.z.union([eR,y.z.instanceof(URL)]),mediaType:y.z.string().optional(),providerOptions:eU.optional()}),eL=y.z.object({type:y.z.literal("file"),data:y.z.union([eR,y.z.instanceof(URL)]),filename:y.z.string().optional(),mediaType:y.z.string(),providerOptions:eU.optional()}),eB=y.z.object({type:y.z.literal("reasoning"),text:y.z.string(),providerOptions:eU.optional()}),eW=y.z.object({type:y.z.literal("tool-call"),toolCallId:y.z.string(),toolName:y.z.string(),input:y.z.unknown(),providerOptions:eU.optional(),providerExecuted:y.z.boolean().optional()}),eG=y.z.discriminatedUnion("type",[y.z.object({type:y.z.literal("text"),value:y.z.string(),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("json"),value:e$,providerOptions:eU.optional()}),y.z.object({type:y.z.literal("execution-denied"),reason:y.z.string().optional(),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("error-text"),value:y.z.string(),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("error-json"),value:e$,providerOptions:eU.optional()}),y.z.object({type:y.z.literal("content"),value:y.z.array(y.z.union([y.z.object({type:y.z.literal("text"),text:y.z.string(),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("media"),data:y.z.string(),mediaType:y.z.string()}),y.z.object({type:y.z.literal("file-data"),data:y.z.string(),mediaType:y.z.string(),filename:y.z.string().optional(),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("file-url"),url:y.z.string(),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("file-id"),fileId:y.z.union([y.z.string(),y.z.record(y.z.string(),y.z.string())]),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("image-data"),data:y.z.string(),mediaType:y.z.string(),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("image-url"),url:y.z.string(),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("image-file-id"),fileId:y.z.union([y.z.string(),y.z.record(y.z.string(),y.z.string())]),providerOptions:eU.optional()}),y.z.object({type:y.z.literal("custom"),providerOptions:eU.optional()})]))})]),eV=y.z.object({type:y.z.literal("tool-result"),toolCallId:y.z.string(),toolName:y.z.string(),output:eG,providerOptions:eU.optional()}),eY=y.z.object({type:y.z.literal("tool-approval-request"),approvalId:y.z.string(),toolCallId:y.z.string()}),eK=y.z.object({type:y.z.literal("tool-approval-response"),approvalId:y.z.string(),approved:y.z.boolean(),reason:y.z.string().optional()}),eZ=y.z.object({role:y.z.literal("system"),content:y.z.string(),providerOptions:eU.optional()}),eH=y.z.object({role:y.z.literal("user"),content:y.z.union([y.z.string(),y.z.array(y.z.union([eF,eJ,eL]))]),providerOptions:eU.optional()}),eQ=y.z.object({role:y.z.literal("assistant"),content:y.z.union([y.z.string(),y.z.array(y.z.union([eF,eL,eB,eW,eV,eY]))]),providerOptions:eU.optional()}),eX=y.z.object({role:y.z.literal("tool"),content:y.z.array(y.z.union([eV,eK])),providerOptions:eU.optional()}),e0=y.z.union([eZ,eH,eQ,eX]);async function e1(e){let t;if(null==e.prompt&&null==e.messages)throw new h.M3({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new h.M3({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system&&!eN(e.system).every(e=>"object"==typeof e&&null!==e&&"role"in e&&"system"===e.role))throw new h.M3({prompt:e,message:"system must be a string, SystemModelMessage, or array of SystemModelMessage"});if(null!=e.prompt&&"string"==typeof e.prompt)t=[{role:"user",content:e.prompt}];else if(null!=e.prompt&&Array.isArray(e.prompt))t=e.prompt;else if(null!=e.messages)t=e.messages;else throw new h.M3({prompt:e,message:"prompt or messages must be defined"});if(0===t.length)throw new h.M3({prompt:e,message:"messages must not be empty"});let a=await (0,f.ZZ)({value:t,schema:y.z.array(e0)});if(!a.success)throw new h.M3({prompt:e,message:"The messages do not match the ModelMessage[] schema.",cause:a.error});return{messages:t,system:e.system}}function e8(e){if(!g.jN.isInstance(e))return e;let t="https://ai-sdk.dev/unauthenticated-ai-gateway";return(null==T?void 0:"production")==="production"?new h.bD({name:"GatewayError",message:`Unauthenticated. Configure AI_GATEWAY_API_KEY or use a provider module. Learn more: ${t}`}):Object.assign(Error(`\x1b[1m\x1b[31mUnauthenticated request to AI Gateway.\x1b[0m

To authenticate, set the \x1b[33mAI_GATEWAY_API_KEY\x1b[0m environment variable with your API key.

Alternatively, you can use a provider module instead of the AI Gateway.

Learn more: \x1b[34m${t}\x1b[0m

`),{name:"GatewayAuthenticationError"})}function e2({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}function e7({model:e,settings:t,telemetry:a,headers:o}){var r;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,a])=>{if("timeout"===t){let o=ez(a);null!=o&&(e[`ai.settings.${t}`]=o)}else e[`ai.settings.${t}`]=a;return e},{}),...Object.entries(null!=(r=null==a?void 0:a.metadata)?r:{}).reduce((e,[t,a])=>(e[`ai.telemetry.metadata.${t}`]=a,e),{}),...Object.entries(null!=o?o:{}).reduce((e,[t,a])=>(void 0!==a&&(e[`ai.request.headers.${t}`]=a),e),{})}}var e3={startSpan:()=>e4,startActiveSpan:(e,t,a,o)=>"function"==typeof t?t(e4):"function"==typeof a?a(e4):"function"==typeof o?o(e4):void 0},e4={spanContext:()=>e6,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},e6={traceId:"",spanId:"",traceFlags:0};function e5({isEnabled:e=!1,tracer:t}={}){return e?t||b.u.getTracer("ai"):e3}async function e9({name:e,tracer:t,attributes:a,fn:o,endWhenDone:r=!0}){return t.startActiveSpan(e,{attributes:await a},async e=>{let t=I._.active();try{let a=await I._.with(t,()=>o(e));return r&&e.end(),a}catch(t){try{te(e,t)}finally{e.end()}throw t}})}function te(e,t){t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:w.s.ERROR,message:t.message})):e.setStatus({code:w.s.ERROR})}async function tt({telemetry:e,attributes:t}){if((null==e?void 0:e.isEnabled)!==!0)return{};let a={};for(let[o,r]of Object.entries(t))if(null!=r){if("object"==typeof r&&"input"in r&&"function"==typeof r.input){if((null==e?void 0:e.recordInputs)===!1)continue;let t=await r.input();null!=t&&(a[o]=t);continue}if("object"==typeof r&&"output"in r&&"function"==typeof r.output){if((null==e?void 0:e.recordOutputs)===!1)continue;let t=await r.output();null!=t&&(a[o]=t);continue}a[o]=r}return a}function ta(e){return JSON.stringify(e.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(e=>{var t;return"file"===e.type?{...e,data:e.data instanceof Uint8Array?"string"==typeof(t=e.data)?t:t instanceof ArrayBuffer?(0,f.n_)(new Uint8Array(t)):(0,f.n_)(t):e.data}:e})})))}function to(e){return{inputTokens:e.inputTokens.total,inputTokenDetails:{noCacheTokens:e.inputTokens.noCache,cacheReadTokens:e.inputTokens.cacheRead,cacheWriteTokens:e.inputTokens.cacheWrite},outputTokens:e.outputTokens.total,outputTokenDetails:{textTokens:e.outputTokens.text,reasoningTokens:e.outputTokens.reasoning},totalTokens:tl(e.inputTokens.total,e.outputTokens.total),raw:e.raw,reasoningTokens:e.outputTokens.reasoning,cachedInputTokens:e.inputTokens.cacheRead}}function tr(){return{inputTokens:void 0,inputTokenDetails:{noCacheTokens:void 0,cacheReadTokens:void 0,cacheWriteTokens:void 0},outputTokens:void 0,outputTokenDetails:{textTokens:void 0,reasoningTokens:void 0},totalTokens:void 0,raw:void 0}}function tn(e,t){var a,o,r,n,l,i,s,u,p,d;return{inputTokens:tl(e.inputTokens,t.inputTokens),inputTokenDetails:{noCacheTokens:tl(null==(a=e.inputTokenDetails)?void 0:a.noCacheTokens,null==(o=t.inputTokenDetails)?void 0:o.noCacheTokens),cacheReadTokens:tl(null==(r=e.inputTokenDetails)?void 0:r.cacheReadTokens,null==(n=t.inputTokenDetails)?void 0:n.cacheReadTokens),cacheWriteTokens:tl(null==(l=e.inputTokenDetails)?void 0:l.cacheWriteTokens,null==(i=t.inputTokenDetails)?void 0:i.cacheWriteTokens)},outputTokens:tl(e.outputTokens,t.outputTokens),outputTokenDetails:{textTokens:tl(null==(s=e.outputTokenDetails)?void 0:s.textTokens,null==(u=t.outputTokenDetails)?void 0:u.textTokens),reasoningTokens:tl(null==(p=e.outputTokenDetails)?void 0:p.reasoningTokens,null==(d=t.outputTokenDetails)?void 0:d.reasoningTokens)},totalTokens:tl(e.totalTokens,t.totalTokens),reasoningTokens:tl(e.reasoningTokens,t.reasoningTokens),cachedInputTokens:tl(e.cachedInputTokens,t.cachedInputTokens)}}function tl(e,t){return null==e&&null==t?void 0:(null!=e?e:0)+(null!=t?t:0)}function ti(e,t){if(void 0===e&&void 0===t)return;if(void 0===e)return t;if(void 0===t)return e;let a={...e};for(let o in t)if(Object.prototype.hasOwnProperty.call(t,o)){let r=t[o];if(void 0===r)continue;let n=o in e?e[o]:void 0,l=null!==r&&"object"==typeof r&&!Array.isArray(r)&&!(r instanceof Date)&&!(r instanceof RegExp),i=null!=n&&"object"==typeof n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);l&&i?a[o]=ti(n,r):a[o]=r}return a}async function ts(e,{maxRetries:t,delayInMs:a,backoffFactor:o,abortSignal:r},n=[]){try{return await e()}catch(u){if((0,f.zf)(u)||0===t)throw u;let l=(0,f.u1)(u),i=[...n,u],s=i.length;if(s>t)throw new ey({message:`Failed after ${s} attempts. Last error: ${l}`,reason:"maxRetriesExceeded",errors:i});if(u instanceof Error&&h.hL.isInstance(u)&&!0===u.isRetryable&&s<=t)return await (0,f.cb)(function({error:e,exponentialBackoffDelay:t}){let a,o=e.responseHeaders;if(!o)return t;let r=o["retry-after-ms"];if(r){let e=parseFloat(r);Number.isNaN(e)||(a=e)}let n=o["retry-after"];if(n&&void 0===a){let e=parseFloat(n);a=Number.isNaN(e)?Date.parse(n)-Date.now():1e3*e}return null!=a&&!Number.isNaN(a)&&0<=a&&(a<6e4||a<t)?a:t}({error:u,exponentialBackoffDelay:a}),{abortSignal:r}),ts(e,{maxRetries:t,delayInMs:o*a,backoffFactor:o,abortSignal:r},i);if(1===s)throw u;throw new ey({message:`Failed after ${s} attempts with non-retryable error: '${l}'`,reason:"errorNotRetryable",errors:i})}}function tu({maxRetries:e,abortSignal:t}){if(null!=e){if(!Number.isInteger(e))throw new E({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new E({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let a=null!=e?e:2;return{maxRetries:a,retry:(({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:a=2,abortSignal:o}={})=>async r=>ts(r,{maxRetries:e,delayInMs:t,backoffFactor:a,abortSignal:o}))({maxRetries:a,abortSignal:t})}}function tp({messages:e}){let t=e.at(-1);if((null==t?void 0:t.role)!="tool")return{approvedToolApprovals:[],deniedToolApprovals:[]};let a={};for(let t of e)if("assistant"===t.role&&"string"!=typeof t.content)for(let e of t.content)"tool-call"===e.type&&(a[e.toolCallId]=e);let o={};for(let t of e)if("assistant"===t.role&&"string"!=typeof t.content)for(let e of t.content)"tool-approval-request"===e.type&&(o[e.approvalId]=e);let r={};for(let e of t.content)"tool-result"===e.type&&(r[e.toolCallId]=e);let n=[],l=[];for(let e of t.content.filter(e=>"tool-approval-response"===e.type)){let t=o[e.approvalId];if(null==t)throw new N({approvalId:e.approvalId});if(null!=r[t.toolCallId])continue;let i=a[t.toolCallId];if(null==i)throw new $({toolCallId:t.toolCallId,approvalId:t.approvalId});let s={approvalRequest:t,approvalResponse:e,toolCall:i};e.approved?n.push(s):l.push(s)}return{approvedToolApprovals:n,deniedToolApprovals:l}}async function td({toolCall:e,tools:t,tracer:a,telemetry:o,messages:r,abortSignal:n,experimental_context:l,onPreliminaryToolResult:i}){let{toolName:s,toolCallId:u,input:p}=e,d=null==t?void 0:t[s];if((null==d?void 0:d.execute)!=null)return e9({name:"ai.toolCall",attributes:tt({telemetry:o,attributes:{...e2({operationId:"ai.toolCall",telemetry:o}),"ai.toolCall.name":s,"ai.toolCall.id":u,"ai.toolCall.args":{output:()=>JSON.stringify(p)}}}),tracer:a,fn:async t=>{let a;try{for await(let t of(0,f.o8)({execute:d.execute.bind(d),input:p,options:{toolCallId:u,messages:r,abortSignal:n,experimental_context:l}}))"preliminary"===t.type?null==i||i({...e,type:"tool-result",output:t.output,preliminary:!0}):a=t.output}catch(a){return te(t,a),{type:"tool-error",toolCallId:u,toolName:s,input:p,error:a,dynamic:"dynamic"===d.type,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}}}try{t.setAttributes(await tt({telemetry:o,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(a)}}}))}catch(e){}return{type:"tool-result",toolCallId:u,toolName:s,input:p,output:a,dynamic:"dynamic"===d.type,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}}}})}function tc(e){let t=e.filter(e=>"text"===e.type);if(0!==t.length)return t.map(e=>e.text).join("")}var tm=class{constructor({data:e,mediaType:t}){const a=e instanceof Uint8Array;this.base64Data=a?void 0:e,this.uint8ArrayData=a?e:void 0,this.mediaType=t}get base64(){return null==this.base64Data&&(this.base64Data=(0,f.n_)(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=(0,f.Z9)(this.base64Data)),this.uint8ArrayData}},tv=class extends tm{constructor(e){super(e),this.type="file"}};async function tf({tool:e,toolCall:t,messages:a,experimental_context:o}){return null!=e.needsApproval&&("boolean"==typeof e.needsApproval?e.needsApproval:await e.needsApproval(t.input,{toolCallId:t.toolCallId,messages:a,experimental_context:o}))}var th={},tg={array:()=>tT,choice:()=>tx,json:()=>tz,object:()=>tw,text:()=>tI};for(var ty in tg)x(th,ty,{get:tg[ty],enumerable:!0});async function tb(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,f.N8)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,f.N8)({text:function(e){let t=["ROOT"],a=-1,o=null;function r(e,r,n){switch(e){case'"':a=r,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=r,o=r,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=r,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":a=r,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":a=r,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,o){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=o,t.pop()}}function l(e,o){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=o,t.pop()}}for(let i=0;i<e.length;i++){let s=e[i];switch(t[t.length-1]){case"ROOT":r(s,i,"FINISH");break;case"INSIDE_OBJECT_START":switch(s){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=i,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===s&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===s&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===s&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":r(s,i,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(s,i);break;case"INSIDE_STRING":switch(s){case'"':t.pop(),a=i;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=i}break;case"INSIDE_ARRAY_START":"]"===s?(a=i,t.pop()):(a=i,r(s,i,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(s){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=i,t.pop();break;default:a=i}break;case"INSIDE_ARRAY_AFTER_COMMA":r(s,i,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=i;break;case"INSIDE_NUMBER":switch(s){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=i;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(s,i),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(s,i);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(s,i);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(s,i);break;default:t.pop()}break;case"INSIDE_LITERAL":{let r=e.substring(o,i+1);"false".startsWith(r)||"true".startsWith(r)||"null".startsWith(r)?a=i:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(s,i):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&l(s,i))}}}let i=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let t=e.substring(o,e.length);"true".startsWith(t)?i+="true".slice(t.length):"false".startsWith(t)?i+="false".slice(t.length):"null".startsWith(t)&&(i+="null".slice(t.length))}}return i}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}var tI=()=>({name:"text",responseFormat:Promise.resolve({type:"text"}),parseCompleteOutput:async({text:e})=>e,parsePartialOutput:async({text:e})=>({partial:e}),createElementStreamTransform(){}}),tw=({schema:e,name:t,description:a})=>{let o=(0,f.mD)(e);return{name:"object",responseFormat:(0,f.hd)(o.jsonSchema).then(e=>({type:"json",schema:e,...null!=t&&{name:t},...null!=a&&{description:a}})),async parseCompleteOutput({text:e},t){let a=await (0,f.N8)({text:e});if(!a.success)throw new V({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let r=await (0,f.ZZ)({value:a.value,schema:o});if(!r.success)throw new V({message:"No object generated: response did not match schema.",cause:r.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return r.value},async parsePartialOutput({text:e}){let t=await tb(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value}}},createElementStreamTransform(){}}},tT=({element:e,name:t,description:a})=>{let o=(0,f.mD)(e);return{name:"array",responseFormat:(0,f.hd)(o.jsonSchema).then(e=>{let{$schema:o,...r}=e;return{type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:r}},required:["elements"],additionalProperties:!1},...null!=t&&{name:t},...null!=a&&{description:a}}}),async parseCompleteOutput({text:e},t){let a=await (0,f.N8)({text:e});if(!a.success)throw new V({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let r=a.value;if(null==r||"object"!=typeof r||!("elements"in r)||!Array.isArray(r.elements))throw new V({message:"No object generated: response did not match schema.",cause:new h.iM({value:r,cause:"response must be an object with an elements array"}),text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});for(let a of r.elements){let r=await (0,f.ZZ)({value:a,schema:o});if(!r.success)throw new V({message:"No object generated: response did not match schema.",cause:r.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason})}return r.elements},async parsePartialOutput({text:e}){let t=await tb(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{let e=t.value;if(null==e||"object"!=typeof e||!("elements"in e)||!Array.isArray(e.elements))return;let a="repaired-parse"===t.state&&e.elements.length>0?e.elements.slice(0,-1):e.elements,r=[];for(let e of a){let t=await (0,f.ZZ)({value:e,schema:o});t.success&&r.push(t.value)}return{partial:r}}}},createElementStreamTransform(){let e=0;return new TransformStream({transform({partialOutput:t},a){if(null!=t)for(;e<t.length;e++)a.enqueue(t[e])}})}}},tx=({options:e,name:t,description:a})=>({name:"choice",responseFormat:Promise.resolve({type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},...null!=t&&{name:t},...null!=a&&{description:a}}),async parseCompleteOutput({text:t},a){let o=await (0,f.N8)({text:t});if(!o.success)throw new V({message:"No object generated: could not parse the response.",cause:o.error,text:t,response:a.response,usage:a.usage,finishReason:a.finishReason});let r=o.value;if(null==r||"object"!=typeof r||!("result"in r)||"string"!=typeof r.result||!e.includes(r.result))throw new V({message:"No object generated: response did not match schema.",cause:new h.iM({value:r,cause:"response must be an object that contains a choice value."}),text:t,response:a.response,usage:a.usage,finishReason:a.finishReason});return r.result},async parsePartialOutput({text:t}){let a=await tb(t);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{let t=a.value;if(null==t||"object"!=typeof t||!("result"in t)||"string"!=typeof t.result)return;let o=e.filter(e=>e.startsWith(t.result));if("successful-parse"===a.state)return o.includes(t.result)?{partial:t.result}:void 0;return 1===o.length?{partial:o[0]}:void 0}}},createElementStreamTransform(){}}),tz=({name:e,description:t}={})=>({name:"json",responseFormat:Promise.resolve({type:"json",...null!=e&&{name:e},...null!=t&&{description:t}}),async parseCompleteOutput({text:e},t){let a=await (0,f.N8)({text:e});if(!a.success)throw new V({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return a.value},async parsePartialOutput({text:e}){let t=await tb(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return void 0===t.value?void 0:{partial:t.value}}},createElementStreamTransform(){}});async function tk({toolCall:e,tools:t,repairToolCall:a,system:o,messages:r}){var n;try{if(null==t){if(e.providerExecuted&&e.dynamic)return await tC(e);throw new et({toolName:e.toolName})}try{return await tE({toolCall:e,tools:t})}catch(l){if(null==a||!(et.isInstance(l)||q.isInstance(l)))throw l;let n=null;try{n=await a({toolCall:e,tools:t,inputSchema:async({toolName:e})=>{let{inputSchema:a}=t[e];return await (0,f.mD)(a).jsonSchema},system:o,messages:r,error:l})}catch(e){throw new en({cause:e,originalError:l})}if(null==n)throw l;return await tE({toolCall:n,tools:t})}}catch(r){let a=await (0,f.N8)({text:e.input}),o=a.success?a.value:e.input;return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:o,dynamic:!0,invalid:!0,error:r,title:null==(n=null==t?void 0:t[e.toolName])?void 0:n.title,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}}}async function tC(e){let t=""===e.input.trim()?{success:!0,value:{}}:await (0,f.N8)({text:e.input});if(!1===t.success)throw new q({toolName:e.toolName,toolInput:e.input,cause:t.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:t.value,providerExecuted:!0,dynamic:!0,providerMetadata:e.providerMetadata}}async function tE({toolCall:e,tools:t}){let a=e.toolName,o=t[a];if(null==o){if(e.providerExecuted&&e.dynamic)return await tC(e);throw new et({toolName:e.toolName,availableTools:Object.keys(t)})}let r=(0,f.mD)(o.inputSchema),n=""===e.input.trim()?await (0,f.ZZ)({value:{},schema:r}):await (0,f.N8)({text:e.input,schema:r});if(!1===n.success)throw new q({toolName:a,toolInput:e.input,cause:n.error});return"dynamic"===o.type?{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,input:n.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,dynamic:!0,title:o.title}:{type:"tool-call",toolCallId:e.toolCallId,toolName:a,input:n.value,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:o.title}}var tS=class{constructor({content:e,finishReason:t,rawFinishReason:a,usage:o,warnings:r,request:n,response:l,providerMetadata:i}){this.content=e,this.finishReason=t,this.rawFinishReason=a,this.usage=o,this.warnings=r,this.request=n,this.response=l,this.providerMetadata=i}get text(){return this.content.filter(e=>"text"===e.type).map(e=>e.text).join("")}get reasoning(){return this.content.filter(e=>"reasoning"===e.type)}get reasoningText(){return 0===this.reasoning.length?void 0:this.reasoning.map(e=>e.text).join("")}get files(){return this.content.filter(e=>"file"===e.type).map(e=>e.file)}get sources(){return this.content.filter(e=>"source"===e.type)}get toolCalls(){return this.content.filter(e=>"tool-call"===e.type)}get staticToolCalls(){return this.toolCalls.filter(e=>!0!==e.dynamic)}get dynamicToolCalls(){return this.toolCalls.filter(e=>!0===e.dynamic)}get toolResults(){return this.content.filter(e=>"tool-result"===e.type)}get staticToolResults(){return this.toolResults.filter(e=>!0!==e.dynamic)}get dynamicToolResults(){return this.toolResults.filter(e=>!0===e.dynamic)}};function tR(e){return({steps:t})=>t.length===e}async function tM({stopConditions:e,steps:t}){return(await Promise.all(e.map(e=>e({steps:t})))).some(e=>e)}async function tN({content:e,tools:t}){let a=[],o=[];for(let a of e)if("source"!==a.type&&("tool-result"!==a.type&&"tool-error"!==a.type||a.providerExecuted)&&("text"!==a.type||0!==a.text.length))switch(a.type){case"text":o.push({type:"text",text:a.text,providerOptions:a.providerMetadata});break;case"reasoning":o.push({type:"reasoning",text:a.text,providerOptions:a.providerMetadata});break;case"file":o.push({type:"file",data:a.file.base64,mediaType:a.file.mediaType,providerOptions:a.providerMetadata});break;case"tool-call":o.push({type:"tool-call",toolCallId:a.toolCallId,toolName:a.toolName,input:a.input,providerExecuted:a.providerExecuted,providerOptions:a.providerMetadata});break;case"tool-result":{let e=await eq({toolCallId:a.toolCallId,input:a.input,tool:null==t?void 0:t[a.toolName],output:a.output,errorMode:"none"});o.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:e,providerOptions:a.providerMetadata});break}case"tool-error":{let e=await eq({toolCallId:a.toolCallId,input:a.input,tool:null==t?void 0:t[a.toolName],output:a.error,errorMode:"json"});o.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:e,providerOptions:a.providerMetadata});break}case"tool-approval-request":o.push({type:"tool-approval-request",approvalId:a.approvalId,toolCallId:a.toolCall.toolCallId})}o.length>0&&a.push({role:"assistant",content:o});let r=[];for(let a of e){if("tool-result"!==a.type&&"tool-error"!==a.type||a.providerExecuted)continue;let e=await eq({toolCallId:a.toolCallId,input:a.input,tool:null==t?void 0:t[a.toolName],output:"tool-result"===a.type?a.output:a.error,errorMode:"tool-error"===a.type?"text":"none"});r.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,output:e,...null!=a.providerMetadata?{providerOptions:a.providerMetadata}:{}})}return r.length>0&&a.push({role:"tool",content:r}),a}function t_(...e){let t=e.filter(e=>null!=e);if(0===t.length)return;if(1===t.length)return t[0];let a=new AbortController;for(let e of t){if(e.aborted){a.abort(e.reason);break}e.addEventListener("abort",()=>{a.abort(e.reason)},{once:!0})}return a.signal}var tO=(0,f.hK)({prefix:"aitxt",size:24});async function tA({model:e,tools:t,toolChoice:a,system:o,prompt:r,messages:n,maxRetries:l,abortSignal:i,timeout:s,headers:u,stopWhen:p=tR(1),experimental_output:d,output:c=d,experimental_telemetry:m,providerOptions:v,experimental_activeTools:h,activeTools:g=h,experimental_prepareStep:y,prepareStep:b=y,experimental_repairToolCall:I,experimental_download:w,experimental_context:T,experimental_include:x,_internal:{generateId:z=tO}={},onStepFinish:k,onFinish:C,...E}){let S=ex(e),R=eN(p),M=ez(s),N=ek(s),_=null!=N?new AbortController:void 0,O=t_(i,null!=M?AbortSignal.timeout(M):void 0,null==_?void 0:_.signal),{maxRetries:A,retry:q}=tu({maxRetries:l,abortSignal:O}),j=eD(E),D=(0,f.WZ)(null!=u?u:{},`ai/${eE}`),P=e7({model:S,telemetry:m,headers:D,settings:{...j,maxRetries:A}}),U=await e1({system:o,prompt:r,messages:n}),F=e5(m);try{return await e9({name:"ai.generateText",attributes:tt({telemetry:m,attributes:{...e2({operationId:"ai.generateText",telemetry:m}),...P,"ai.model.provider":S.provider,"ai.model.id":S.modelId,"ai.prompt":{input:()=>JSON.stringify({system:o,prompt:r,messages:n})}}}),tracer:F,fn:async e=>{var r,n,l,i,s,u,p,d,h,y,M;let A,j,J=U.messages,L=[],{approvedToolApprovals:B,deniedToolApprovals:W}=tp({messages:J}),G=B.filter(e=>!e.toolCall.providerExecuted);if(W.length>0||G.length>0){let e=await tq({toolCalls:G.map(e=>e.toolCall),tools:t,tracer:F,telemetry:m,messages:J,abortSignal:O,experimental_context:T}),a=[];for(let o of e){let e=await eq({toolCallId:o.toolCallId,input:o.input,tool:null==t?void 0:t[o.toolName],output:"tool-result"===o.type?o.output:o.error,errorMode:"tool-error"===o.type?"json":"none"});a.push({type:"tool-result",toolCallId:o.toolCallId,toolName:o.toolName,output:e})}for(let e of W)a.push({type:"tool-result",toolCallId:e.toolCall.toolCallId,toolName:e.toolCall.toolName,output:{type:"execution-denied",reason:e.approvalResponse.reason,...e.toolCall.providerExecuted&&{providerOptions:{openai:{approvalId:e.approvalResponse.approvalId}}}}});L.push({role:"tool",content:a})}let V=[...B,...W].filter(e=>e.toolCall.providerExecuted);V.length>0&&L.push({role:"tool",content:V.map(e=>({type:"tool-approval-response",approvalId:e.approvalResponse.approvalId,approved:e.approvalResponse.approved,reason:e.approvalResponse.reason,providerExecuted:!0}))});let Y=eD(E),K=[],Z=[],H=[],Q=new Map;do{let e=null!=N?setTimeout(()=>_.abort(),N):void 0;try{let e=[...J,...L],C=await (null==b?void 0:b({model:S,steps:H,stepNumber:H.length,messages:e,experimental_context:T})),R=ex(null!=(r=null==C?void 0:C.model)?r:S),N=await e_({prompt:{system:null!=(n=null==C?void 0:C.system)?n:U.system,messages:null!=(l=null==C?void 0:C.messages)?l:e},supportedUrls:await R.supportedUrls,download:w});T=null!=(i=null==C?void 0:C.experimental_context)?i:T;let{toolChoice:_,tools:j}=await eP({tools:t,toolChoice:null!=(s=null==C?void 0:C.toolChoice)?s:a,activeTools:null!=(u=null==C?void 0:C.activeTools)?u:g});A=await q(()=>{var e;return e9({name:"ai.generateText.doGenerate",attributes:tt({telemetry:m,attributes:{...e2({operationId:"ai.generateText.doGenerate",telemetry:m}),...P,"ai.model.provider":R.provider,"ai.model.id":R.modelId,"ai.prompt.messages":{input:()=>ta(N)},"ai.prompt.tools":{input:()=>null==j?void 0:j.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>null!=_?JSON.stringify(_):void 0},"gen_ai.system":R.provider,"gen_ai.request.model":R.modelId,"gen_ai.request.frequency_penalty":E.frequencyPenalty,"gen_ai.request.max_tokens":E.maxOutputTokens,"gen_ai.request.presence_penalty":E.presencePenalty,"gen_ai.request.stop_sequences":E.stopSequences,"gen_ai.request.temperature":null!=(e=E.temperature)?e:void 0,"gen_ai.request.top_k":E.topK,"gen_ai.request.top_p":E.topP}}),tracer:F,fn:async e=>{var t,a,o,r,n,l,i,s;let u=ti(v,null==C?void 0:C.providerOptions),p=await R.doGenerate({...Y,tools:j,toolChoice:_,responseFormat:await (null==c?void 0:c.responseFormat),prompt:N,providerOptions:u,abortSignal:O,headers:D}),d={id:null!=(a=null==(t=p.response)?void 0:t.id)?a:z(),timestamp:null!=(r=null==(o=p.response)?void 0:o.timestamp)?r:new Date,modelId:null!=(l=null==(n=p.response)?void 0:n.modelId)?l:R.modelId,headers:null==(i=p.response)?void 0:i.headers,body:null==(s=p.response)?void 0:s.body};return e.setAttributes(await tt({telemetry:m,attributes:{"ai.response.finishReason":p.finishReason.unified,"ai.response.text":{output:()=>tc(p.content)},"ai.response.toolCalls":{output:()=>{let e=tD(p.content);return null==e?void 0:JSON.stringify(e)}},"ai.response.id":d.id,"ai.response.model":d.modelId,"ai.response.timestamp":d.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(p.providerMetadata),"ai.usage.promptTokens":p.usage.inputTokens.total,"ai.usage.completionTokens":p.usage.outputTokens.total,"gen_ai.response.finish_reasons":[p.finishReason.unified],"gen_ai.response.id":d.id,"gen_ai.response.model":d.modelId,"gen_ai.usage.input_tokens":p.usage.inputTokens.total,"gen_ai.usage.output_tokens":p.usage.outputTokens.total}})),{...p,response:d}}})});let B=await Promise.all(A.content.filter(e=>"tool-call"===e.type).map(a=>tk({toolCall:a,tools:t,repairToolCall:I,system:o,messages:e}))),W={};for(let a of B){if(a.invalid)continue;let o=null==t?void 0:t[a.toolName];null!=o&&((null==o?void 0:o.onInputAvailable)!=null&&await o.onInputAvailable({input:a.input,toolCallId:a.toolCallId,messages:e,abortSignal:O,experimental_context:T}),await tf({tool:o,toolCall:a,messages:e,experimental_context:T})&&(W[a.toolCallId]={type:"tool-approval-request",approvalId:z(),toolCall:a}))}let G=B.filter(e=>e.invalid&&e.dynamic);for(let e of(Z=[],G))Z.push({type:"tool-error",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,error:(0,f.u1)(e.error),dynamic:!0});for(let a of(K=B.filter(e=>!e.providerExecuted),null!=t&&Z.push(...await tq({toolCalls:K.filter(e=>!e.invalid&&null==W[e.toolCallId]),tools:t,tracer:F,telemetry:m,messages:e,abortSignal:O,experimental_context:T})),B)){if(!a.providerExecuted)continue;let e=null==t?void 0:t[a.toolName];(null==e?void 0:e.type)==="provider"&&e.supportsDeferredResults&&(A.content.some(e=>"tool-result"===e.type&&e.toolCallId===a.toolCallId)||Q.set(a.toolCallId,{toolName:a.toolName}))}for(let e of A.content)"tool-result"===e.type&&Q.delete(e.toolCallId);let V=function({content:e,toolCalls:t,toolOutputs:a,toolApprovalRequests:o,tools:r}){let n=[];for(let a of e)switch(a.type){case"text":case"reasoning":case"source":n.push(a);break;case"file":n.push({type:"file",file:new tm(a),...null!=a.providerMetadata?{providerMetadata:a.providerMetadata}:{}});break;case"tool-call":n.push(t.find(e=>e.toolCallId===a.toolCallId));break;case"tool-result":{let e=t.find(e=>e.toolCallId===a.toolCallId);if(null==e){let e=null==r?void 0:r[a.toolName];if(!((null==e?void 0:e.type)==="provider"&&e.supportsDeferredResults))throw Error(`Tool call ${a.toolCallId} not found.`);a.isError?n.push({type:"tool-error",toolCallId:a.toolCallId,toolName:a.toolName,input:void 0,error:a.result,providerExecuted:!0,dynamic:a.dynamic}):n.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,input:void 0,output:a.result,providerExecuted:!0,dynamic:a.dynamic});break}a.isError?n.push({type:"tool-error",toolCallId:a.toolCallId,toolName:a.toolName,input:e.input,error:a.result,providerExecuted:!0,dynamic:e.dynamic}):n.push({type:"tool-result",toolCallId:a.toolCallId,toolName:a.toolName,input:e.input,output:a.result,providerExecuted:!0,dynamic:e.dynamic});break}case"tool-approval-request":{let e=t.find(e=>e.toolCallId===a.toolCallId);if(null==e)throw new $({toolCallId:a.toolCallId,approvalId:a.approvalId});n.push({type:"tool-approval-request",approvalId:a.approvalId,toolCall:e})}}return[...n,...a,...o]}({content:A.content,toolCalls:B,toolOutputs:Z,toolApprovalRequests:Object.values(W),tools:t});L.push(...await tN({content:V,tools:t}));let X=null==(p=null==x?void 0:x.requestBody)||p?null!=(d=A.request)?d:{}:{...A.request,body:void 0},ee={...A.response,messages:structuredClone(L),body:null==(h=null==x?void 0:x.responseBody)||h?null==(y=A.response)?void 0:y.body:void 0},et=new tS({content:V,finishReason:A.finishReason.unified,rawFinishReason:A.finishReason.raw,usage:to(A.usage),warnings:A.warnings,providerMetadata:A.providerMetadata,request:X,response:ee});eI({warnings:null!=(M=A.warnings)?M:[],provider:R.provider,model:R.modelId}),H.push(et),await (null==k?void 0:k(et))}finally{null!=e&&clearTimeout(e)}}while((K.length>0&&Z.length===K.length||Q.size>0)&&!await tM({stopConditions:R,steps:H}));e.setAttributes(await tt({telemetry:m,attributes:{"ai.response.finishReason":A.finishReason.unified,"ai.response.text":{output:()=>tc(A.content)},"ai.response.toolCalls":{output:()=>{let e=tD(A.content);return null==e?void 0:JSON.stringify(e)}},"ai.response.providerMetadata":JSON.stringify(A.providerMetadata),"ai.usage.promptTokens":A.usage.inputTokens.total,"ai.usage.completionTokens":A.usage.outputTokens.total}}));let X=H[H.length-1],ee=H.reduce((e,t)=>tn(e,t.usage),{inputTokens:void 0,outputTokens:void 0,totalTokens:void 0,reasoningTokens:void 0,cachedInputTokens:void 0});if(await (null==C?void 0:C({finishReason:X.finishReason,rawFinishReason:X.rawFinishReason,usage:X.usage,content:X.content,text:X.text,reasoningText:X.reasoningText,reasoning:X.reasoning,files:X.files,sources:X.sources,toolCalls:X.toolCalls,staticToolCalls:X.staticToolCalls,dynamicToolCalls:X.dynamicToolCalls,toolResults:X.toolResults,staticToolResults:X.staticToolResults,dynamicToolResults:X.dynamicToolResults,request:X.request,response:X.response,warnings:X.warnings,providerMetadata:X.providerMetadata,steps:H,totalUsage:ee,experimental_context:T})),"stop"===X.finishReason){let e=null!=c?c:tI();j=await e.parseCompleteOutput({text:X.text},{response:X.response,usage:X.usage,finishReason:X.finishReason})}return new tj({steps:H,totalUsage:ee,output:j})}})}catch(e){throw e8(e)}}async function tq({toolCalls:e,tools:t,tracer:a,telemetry:o,messages:r,abortSignal:n,experimental_context:l}){return(await Promise.all(e.map(async e=>td({toolCall:e,tools:t,tracer:a,telemetry:o,messages:r,abortSignal:n,experimental_context:l})))).filter(e=>null!=e)}var tj=class{constructor(e){this.steps=e.steps,this._output=e.output,this.totalUsage=e.totalUsage}get finalStep(){return this.steps[this.steps.length-1]}get content(){return this.finalStep.content}get text(){return this.finalStep.text}get files(){return this.finalStep.files}get reasoningText(){return this.finalStep.reasoningText}get reasoning(){return this.finalStep.reasoning}get toolCalls(){return this.finalStep.toolCalls}get staticToolCalls(){return this.finalStep.staticToolCalls}get dynamicToolCalls(){return this.finalStep.dynamicToolCalls}get toolResults(){return this.finalStep.toolResults}get staticToolResults(){return this.finalStep.staticToolResults}get dynamicToolResults(){return this.finalStep.dynamicToolResults}get sources(){return this.finalStep.sources}get finishReason(){return this.finalStep.finishReason}get rawFinishReason(){return this.finalStep.rawFinishReason}get warnings(){return this.finalStep.warnings}get providerMetadata(){return this.finalStep.providerMetadata}get response(){return this.finalStep.response}get request(){return this.finalStep.request}get usage(){return this.finalStep.usage}get experimental_output(){return this.output}get output(){if(null==this._output)throw new H;return this._output}};function tD(e){let t=e.filter(e=>"tool-call"===e.type);if(0!==t.length)return t.map(e=>({toolCallId:e.toolCallId,toolName:e.toolName,input:e.input}))}function tP(e,t){let a=new Headers(null!=e?e:{});for(let[e,o]of Object.entries(t))a.has(e)||a.set(e,o);return a}function t$({response:e,status:t,statusText:a,headers:o,stream:r}){let n=null!=t?t:200;void 0!==a?e.writeHead(n,a,o):e.writeHead(n,o);let l=r.getReader();(async()=>{try{for(;;){let{done:t,value:a}=await l.read();if(t)break;e.write(a)||await new Promise(t=>{e.once("drain",t)})}}catch(e){throw e}finally{e.end()}})()}var tU=class extends TransformStream{constructor(){super({transform(e,t){t.enqueue(`data: ${JSON.stringify(e)}

`)},flush(e){e.enqueue("data: [DONE]\n\n")}})}},tF={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function tJ({status:e,statusText:t,headers:a,stream:o,consumeSseStream:r}){let n=o.pipeThrough(new tU);if(r){let[e,t]=n.tee();n=e,r({stream:t})}return new Response(n.pipeThrough(new TextEncoderStream),{status:e,statusText:t,headers:tP(a,tF)})}var tL=(0,f.ID)(()=>(0,f.jN)(y.z.union([y.z.strictObject({type:y.z.literal("text-start"),id:y.z.string(),providerMetadata:eU.optional()}),y.z.strictObject({type:y.z.literal("text-delta"),id:y.z.string(),delta:y.z.string(),providerMetadata:eU.optional()}),y.z.strictObject({type:y.z.literal("text-end"),id:y.z.string(),providerMetadata:eU.optional()}),y.z.strictObject({type:y.z.literal("error"),errorText:y.z.string()}),y.z.strictObject({type:y.z.literal("tool-input-start"),toolCallId:y.z.string(),toolName:y.z.string(),providerExecuted:y.z.boolean().optional(),providerMetadata:eU.optional(),dynamic:y.z.boolean().optional(),title:y.z.string().optional()}),y.z.strictObject({type:y.z.literal("tool-input-delta"),toolCallId:y.z.string(),inputTextDelta:y.z.string()}),y.z.strictObject({type:y.z.literal("tool-input-available"),toolCallId:y.z.string(),toolName:y.z.string(),input:y.z.unknown(),providerExecuted:y.z.boolean().optional(),providerMetadata:eU.optional(),dynamic:y.z.boolean().optional(),title:y.z.string().optional()}),y.z.strictObject({type:y.z.literal("tool-input-error"),toolCallId:y.z.string(),toolName:y.z.string(),input:y.z.unknown(),providerExecuted:y.z.boolean().optional(),providerMetadata:eU.optional(),dynamic:y.z.boolean().optional(),errorText:y.z.string(),title:y.z.string().optional()}),y.z.strictObject({type:y.z.literal("tool-approval-request"),approvalId:y.z.string(),toolCallId:y.z.string()}),y.z.strictObject({type:y.z.literal("tool-output-available"),toolCallId:y.z.string(),output:y.z.unknown(),providerExecuted:y.z.boolean().optional(),dynamic:y.z.boolean().optional(),preliminary:y.z.boolean().optional()}),y.z.strictObject({type:y.z.literal("tool-output-error"),toolCallId:y.z.string(),errorText:y.z.string(),providerExecuted:y.z.boolean().optional(),dynamic:y.z.boolean().optional()}),y.z.strictObject({type:y.z.literal("tool-output-denied"),toolCallId:y.z.string()}),y.z.strictObject({type:y.z.literal("reasoning-start"),id:y.z.string(),providerMetadata:eU.optional()}),y.z.strictObject({type:y.z.literal("reasoning-delta"),id:y.z.string(),delta:y.z.string(),providerMetadata:eU.optional()}),y.z.strictObject({type:y.z.literal("reasoning-end"),id:y.z.string(),providerMetadata:eU.optional()}),y.z.strictObject({type:y.z.literal("source-url"),sourceId:y.z.string(),url:y.z.string(),title:y.z.string().optional(),providerMetadata:eU.optional()}),y.z.strictObject({type:y.z.literal("source-document"),sourceId:y.z.string(),mediaType:y.z.string(),title:y.z.string(),filename:y.z.string().optional(),providerMetadata:eU.optional()}),y.z.strictObject({type:y.z.literal("file"),url:y.z.string(),mediaType:y.z.string(),providerMetadata:eU.optional()}),y.z.strictObject({type:y.z.custom(e=>"string"==typeof e&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:y.z.string().optional(),data:y.z.unknown(),transient:y.z.boolean().optional()}),y.z.strictObject({type:y.z.literal("start-step")}),y.z.strictObject({type:y.z.literal("finish-step")}),y.z.strictObject({type:y.z.literal("start"),messageId:y.z.string().optional(),messageMetadata:y.z.unknown().optional()}),y.z.strictObject({type:y.z.literal("finish"),finishReason:y.z.enum(["stop","length","content-filter","tool-calls","error","other"]).optional(),messageMetadata:y.z.unknown().optional()}),y.z.strictObject({type:y.z.literal("abort"),reason:y.z.string().optional()}),y.z.strictObject({type:y.z.literal("message-metadata"),messageMetadata:y.z.unknown()})])));function tB(e){return e.type.startsWith("tool-")}function tW(e){return tB(e)||"dynamic-tool"===e.type}function tG(e){return e.type.split("-").slice(1).join("-")}function tV({messageId:e,originalMessages:t=[],onFinish:a,onError:o,stream:r}){let n=null==t?void 0:t[t.length-1];(null==n?void 0:n.role)!=="assistant"?n=void 0:e=n.id;let l=!1,i=r.pipeThrough(new TransformStream({transform(t,a){"start"===t.type&&null==t.messageId&&null!=e&&(t.messageId=e),"abort"===t.type&&(l=!0),a.enqueue(t)}}));if(null==a)return i;let s=function({lastMessage:e,messageId:t}){return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:n?structuredClone(n):void 0,messageId:null!=e?e:""}),u=!1,p=async()=>{if(u||!a)return;u=!0;let e=s.message.id===(null==n?void 0:n.id);await a({isAborted:l,isContinuation:e,responseMessage:s.message,messages:[...e?t.slice(0,-1):t,s.message],finishReason:s.finishReason})};return(function({stream:e,messageMetadataSchema:t,dataPartSchemas:a,runUpdateMessageJob:o,onError:r,onToolCall:n,onData:l}){return e.pipeThrough(new TransformStream({async transform(e,i){await o(async({state:o,write:s})=>{var u,p,d,c;function m(e){let t=o.message.parts.filter(tW).find(t=>t.toolCallId===e);if(null==t)throw new ep({chunkType:"tool-invocation",chunkId:e,message:`No tool invocation found for tool call ID "${e}".`});return t}function v(e){var t;let a=o.message.parts.find(t=>tB(t)&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=e.rawInput,a.preliminary=e.preliminary,void 0!==e.title&&(a.title=e.title),a.providerExecuted=null!=(t=e.providerExecuted)?t:a.providerExecuted,null!=e.providerMetadata&&(a.callProviderMetadata=e.providerMetadata)):o.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,title:e.title,input:e.input,output:e.output,rawInput:e.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}function h(e){var t,a;let r=o.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=r?(r.state=e.state,r.toolName=e.toolName,r.input=e.input,r.output=e.output,r.errorText=e.errorText,r.rawInput=null!=(t=e.rawInput)?t:r.rawInput,r.preliminary=e.preliminary,void 0!==e.title&&(r.title=e.title),r.providerExecuted=null!=(a=e.providerExecuted)?a:r.providerExecuted,null!=e.providerMetadata&&(r.callProviderMetadata=e.providerMetadata)):o.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,preliminary:e.preliminary,providerExecuted:e.providerExecuted,title:e.title,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}async function g(e){if(null!=e){let a=null!=o.message.metadata?ti(o.message.metadata,e):e;null!=t&&await (0,f.k5)({value:a,schema:t,context:{field:"message.metadata",entityId:o.message.id}}),o.message.metadata=a}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};o.activeTextParts[e.id]=t,o.message.parts.push(t),s();break}case"text-delta":{let t=o.activeTextParts[e.id];if(null==t)throw new ep({chunkType:"text-delta",chunkId:e.id,message:`Received text-delta for missing text part with ID "${e.id}". Ensure a "text-start" chunk is sent before any "text-delta" chunks.`});t.text+=e.delta,t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,s();break}case"text-end":{let t=o.activeTextParts[e.id];if(null==t)throw new ep({chunkType:"text-end",chunkId:e.id,message:`Received text-end for missing text part with ID "${e.id}". Ensure a "text-start" chunk is sent before any "text-end" chunks.`});t.state="done",t.providerMetadata=null!=(p=e.providerMetadata)?p:t.providerMetadata,delete o.activeTextParts[e.id],s();break}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};o.activeReasoningParts[e.id]=t,o.message.parts.push(t),s();break}case"reasoning-delta":{let t=o.activeReasoningParts[e.id];if(null==t)throw new ep({chunkType:"reasoning-delta",chunkId:e.id,message:`Received reasoning-delta for missing reasoning part with ID "${e.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-delta" chunks.`});t.text+=e.delta,t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,s();break}case"reasoning-end":{let t=o.activeReasoningParts[e.id];if(null==t)throw new ep({chunkType:"reasoning-end",chunkId:e.id,message:`Received reasoning-end for missing reasoning part with ID "${e.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-end" chunks.`});t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,t.state="done",delete o.activeReasoningParts[e.id],s();break}case"file":o.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),s();break;case"source-url":o.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),s();break;case"source-document":o.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),s();break;case"tool-input-start":{let t=o.message.parts.filter(tB);o.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic,title:e.title},e.dynamic?h({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted,title:e.title,providerMetadata:e.providerMetadata}):v({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted,title:e.title,providerMetadata:e.providerMetadata}),s();break}case"tool-input-delta":{let t=o.partialToolCalls[e.toolCallId];if(null==t)throw new ep({chunkType:"tool-input-delta",chunkId:e.toolCallId,message:`Received tool-input-delta for missing tool call with ID "${e.toolCallId}". Ensure a "tool-input-start" chunk is sent before any "tool-input-delta" chunks.`});t.text+=e.inputTextDelta;let{value:a}=await tb(t.text);t.dynamic?h({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a,title:t.title}):v({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a,title:t.title}),s();break}case"tool-input-available":e.dynamic?h({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}):v({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}),s(),n&&!e.providerExecuted&&await n({toolCall:e});break;case"tool-input-error":e.dynamic?h({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):v({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),s();break;case"tool-approval-request":{let t=m(e.toolCallId);t.state="approval-requested",t.approval={id:e.approvalId},s();break}case"tool-output-denied":m(e.toolCallId).state="output-denied",s();break;case"tool-output-available":{let t=m(e.toolCallId);"dynamic-tool"===t.type?h({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output,preliminary:e.preliminary,providerExecuted:e.providerExecuted,title:t.title}):v({toolCallId:e.toolCallId,toolName:tG(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary,title:t.title}),s();break}case"tool-output-error":{let t=m(e.toolCallId);"dynamic-tool"===t.type?h({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}):v({toolCallId:e.toolCallId,toolName:tG(t),state:"output-error",input:t.input,rawInput:t.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}),s();break}case"start-step":o.message.parts.push({type:"step-start"});break;case"finish-step":o.activeTextParts={},o.activeReasoningParts={};break;case"start":null!=e.messageId&&(o.message.id=e.messageId),await g(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&s();break;case"finish":null!=e.finishReason&&(o.finishReason=e.finishReason),await g(e.messageMetadata),null!=e.messageMetadata&&s();break;case"message-metadata":await g(e.messageMetadata),null!=e.messageMetadata&&s();break;case"error":null==r||r(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==a?void 0:a[e.type])!=null){let t=o.message.parts.findIndex(t=>"id"in t&&"data"in t&&t.id===e.id&&t.type===e.type),r=t>=0?t:o.message.parts.length;await (0,f.k5)({value:e.data,schema:a[e.type],context:{field:`message.parts[${r}].data`,entityName:e.type,entityId:e.id}})}if(e.transient){null==l||l(e);break}let t=null!=e.id?o.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:o.message.parts.push(e),null==l||l(e),s()}}i.enqueue(e)})}}))})({stream:i,runUpdateMessageJob:async e=>{await e({state:s,write:()=>{}})},onError:o}).pipeThrough(new TransformStream({transform(e,t){t.enqueue(e)},async cancel(){await p()},async flush(){await p()}}))}function tY(e){let t=e.pipeThrough(new TransformStream);return t[Symbol.asyncIterator]=function(){let e=this.getReader(),t=!1;async function a(a){var o;if(!t){t=!0;try{a&&await (null==(o=e.cancel)?void 0:o.call(e))}finally{try{e.releaseLock()}catch(e){}}}}return{async next(){if(t)return{done:!0,value:void 0};let{done:o,value:r}=await e.read();return o?(await a(!0),{done:!0,value:void 0}):{done:!1,value:r}},return:async()=>(await a(!0),{done:!0,value:void 0}),async throw(e){throw await a(!0),e}}},t}async function tK({stream:e,onError:t}){let a=e.getReader();try{for(;;){let{done:e}=await a.read();if(e)break}}catch(e){null==t||t(e)}finally{a.releaseLock()}}function tZ(){let e,t;return{promise:new Promise((a,o)=>{e=a,t=o}),resolve:e,reject:t}}function tH(){var e,t;return null!=(t=null==(e=null==globalThis?void 0:globalThis.performance)?void 0:e.now())?t:Date.now()}var tQ=(0,f.hK)({prefix:"aitxt",size:24});function tX({model:e,tools:t,toolChoice:a,system:o,prompt:r,messages:n,maxRetries:l,abortSignal:i,timeout:s,headers:u,stopWhen:p=tR(1),experimental_output:d,output:c=d,experimental_telemetry:m,prepareStep:v,providerOptions:f,experimental_activeTools:h,activeTools:g=h,experimental_repairToolCall:y,experimental_transform:b,experimental_download:I,includeRawChunks:w=!1,onChunk:T,onError:x=({error:e})=>{console.error(e)},onFinish:z,onAbort:k,onStepFinish:C,experimental_context:E,experimental_include:S,_internal:{now:R=tH,generateId:M=tQ}={},...N}){let _=ez(s),O=ek(s),A=function(e){if(null!=e&&"number"!=typeof e)return e.chunkMs}(s),q=null!=O?new AbortController:void 0,j=null!=A?new AbortController:void 0;return new t0({model:ex(e),telemetry:m,headers:u,settings:N,maxRetries:l,abortSignal:t_(i,null!=_?AbortSignal.timeout(_):void 0,null==q?void 0:q.signal,null==j?void 0:j.signal),stepTimeoutMs:O,stepAbortController:q,chunkTimeoutMs:A,chunkAbortController:j,system:o,prompt:r,messages:n,tools:t,toolChoice:a,transforms:eN(b),activeTools:g,repairToolCall:y,stopConditions:eN(p),output:c,providerOptions:f,prepareStep:v,includeRawChunks:w,onChunk:T,onError:x,onFinish:z,onAbort:k,onStepFinish:C,now:R,generateId:M,experimental_context:E,download:I,include:S})}var t0=class{constructor({model:e,telemetry:t,headers:a,settings:o,maxRetries:r,abortSignal:n,stepTimeoutMs:l,stepAbortController:i,chunkTimeoutMs:s,chunkAbortController:u,system:p,prompt:d,messages:c,tools:m,toolChoice:v,transforms:g,activeTools:y,repairToolCall:b,stopConditions:I,output:w,providerOptions:T,prepareStep:x,includeRawChunks:z,now:k,generateId:C,onChunk:E,onError:S,onFinish:R,onAbort:M,onStepFinish:N,experimental_context:_,download:O,include:A}){let q,j,D,P,U;this._totalUsage=new f.e1,this._finishReason=new f.e1,this._rawFinishReason=new f.e1,this._steps=new f.e1,this.outputSpecification=w,this.includeRawChunks=z,this.tools=m;let F=[];const J=[];let L={},B=[];const W=[],G=new Map;let V={},Y={};const K=new TransformStream({async transform(t,a){var o,r,n,l;a.enqueue(t);let{part:i}=t;if(("text-delta"===i.type||"reasoning-delta"===i.type||"source"===i.type||"tool-call"===i.type||"tool-result"===i.type||"tool-input-start"===i.type||"tool-input-delta"===i.type||"raw"===i.type)&&await (null==E?void 0:E({chunk:i})),"error"===i.type&&await S({error:e8(i.error)}),"text-start"===i.type&&(V[i.id]={type:"text",text:"",providerMetadata:i.providerMetadata},F.push(V[i.id])),"text-delta"===i.type){let e=V[i.id];if(null==e)return void a.enqueue({part:{type:"error",error:`text part ${i.id} not found`},partialOutput:void 0});e.text+=i.text,e.providerMetadata=null!=(o=i.providerMetadata)?o:e.providerMetadata}if("text-end"===i.type){let e=V[i.id];if(null==e)return void a.enqueue({part:{type:"error",error:`text part ${i.id} not found`},partialOutput:void 0});e.providerMetadata=null!=(r=i.providerMetadata)?r:e.providerMetadata,delete V[i.id]}if("reasoning-start"===i.type&&(Y[i.id]={type:"reasoning",text:"",providerMetadata:i.providerMetadata},F.push(Y[i.id])),"reasoning-delta"===i.type){let e=Y[i.id];if(null==e)return void a.enqueue({part:{type:"error",error:`reasoning part ${i.id} not found`},partialOutput:void 0});e.text+=i.text,e.providerMetadata=null!=(n=i.providerMetadata)?n:e.providerMetadata}if("reasoning-end"===i.type){let e=Y[i.id];if(null==e)return void a.enqueue({part:{type:"error",error:`reasoning part ${i.id} not found`},partialOutput:void 0});e.providerMetadata=null!=(l=i.providerMetadata)?l:e.providerMetadata,delete Y[i.id]}if("file"===i.type&&F.push({type:"file",file:i.file}),"source"===i.type&&F.push(i),"tool-call"===i.type&&F.push(i),"tool-result"!==i.type||i.preliminary||F.push(i),"tool-approval-request"===i.type&&F.push(i),"tool-error"===i.type&&F.push(i),"start-step"===i.type&&(F=[],Y={},V={},L=i.request,B=i.warnings),"finish-step"===i.type){let t=await tN({content:F,tools:m}),a=new tS({content:F,finishReason:i.finishReason,rawFinishReason:i.rawFinishReason,usage:i.usage,warnings:B,request:L,response:{...i.response,messages:[...J,...t]},providerMetadata:i.providerMetadata});await (null==N?void 0:N(a)),eI({warnings:B,provider:e.provider,model:e.modelId}),W.push(a),J.push(...t),q.resolve()}"finish"===i.type&&(U=i.totalUsage,D=i.finishReason,P=i.rawFinishReason)},async flush(e){try{if(0===W.length){let e=(null==n?void 0:n.aborted)?n.reason:new H({message:"No output generated. Check the stream for errors."});en._finishReason.reject(e),en._rawFinishReason.reject(e),en._totalUsage.reject(e),en._steps.reject(e);return}let e=null!=D?D:"other",a=null!=U?U:tr();en._finishReason.resolve(e),en._rawFinishReason.resolve(P),en._totalUsage.resolve(a),en._steps.resolve(W);let o=W[W.length-1];await (null==R?void 0:R({finishReason:o.finishReason,rawFinishReason:o.rawFinishReason,totalUsage:a,usage:o.usage,content:o.content,text:o.text,reasoningText:o.reasoningText,reasoning:o.reasoning,files:o.files,sources:o.sources,toolCalls:o.toolCalls,staticToolCalls:o.staticToolCalls,dynamicToolCalls:o.dynamicToolCalls,toolResults:o.toolResults,staticToolResults:o.staticToolResults,dynamicToolResults:o.dynamicToolResults,request:o.request,response:o.response,warnings:o.warnings,providerMetadata:o.providerMetadata,steps:W,experimental_context:_})),j.setAttributes(await tt({telemetry:t,attributes:{"ai.response.finishReason":e,"ai.response.text":{output:()=>o.text},"ai.response.toolCalls":{output:()=>{var e;return(null==(e=o.toolCalls)?void 0:e.length)?JSON.stringify(o.toolCalls):void 0}},"ai.response.providerMetadata":JSON.stringify(o.providerMetadata),"ai.usage.inputTokens":a.inputTokens,"ai.usage.outputTokens":a.outputTokens,"ai.usage.totalTokens":a.totalTokens,"ai.usage.reasoningTokens":a.reasoningTokens,"ai.usage.cachedInputTokens":a.cachedInputTokens}}))}catch(t){e.error(t)}finally{j.end()}}}),Z=function(){let e=[],t=null,a=!1,o=tZ(),r=()=>{a=!0,o.resolve(),e.forEach(e=>e.cancel()),e=[],null==t||t.close()},n=async()=>{if(a&&0===e.length){null==t||t.close();return}if(0===e.length)return o=tZ(),await o.promise,n();try{let{value:o,done:r}=await e[0].read();r?(e.shift(),0===e.length&&a?null==t||t.close():await n()):null==t||t.enqueue(o)}catch(a){null==t||t.error(a),e.shift(),r()}};return{stream:new ReadableStream({start(e){t=e},pull:n,async cancel(){for(let t of e)await t.cancel();e=[],a=!0}}),addStream:t=>{if(a)throw Error("Cannot add inner stream: outer stream is closed");e.push(t.getReader()),o.resolve()},close:()=>{a=!0,o.resolve(),0===e.length&&(null==t||t.close())},terminate:r}}();this.addStream=Z.addStream,this.closeStream=Z.close;const Q=Z.stream.getReader();let X=new ReadableStream({async start(e){e.enqueue({type:"start"})},async pull(e){function t(){null==M||M({steps:W}),e.enqueue({type:"abort",...(null==n?void 0:n.reason)!==void 0?{reason:(0,h.u1)(n.reason)}:{}}),e.close()}try{let{done:a,value:o}=await Q.read();if(a)return void e.close();if(null==n?void 0:n.aborted)return void t();e.enqueue(o)}catch(a){(0,f.zf)(a)&&(null==n?void 0:n.aborted)?t():e.error(a)}},cancel:e=>Z.stream.cancel(e)});for(const e of g)X=X.pipeThrough(e({tools:m,stopStream(){Z.terminate()}}));this.baseStream=X.pipeThrough(function(e){let t,a,o="",r="",n="";function l({controller:e,partialOutput:o}){e.enqueue({part:{type:"text-delta",id:t,text:r,providerMetadata:a},partialOutput:o}),r=""}return new TransformStream({async transform(i,s){var u;if("finish-step"===i.type&&r.length>0&&l({controller:s}),"text-delta"!==i.type&&"text-start"!==i.type&&"text-end"!==i.type)return void s.enqueue({part:i,partialOutput:void 0});if(null==t)t=i.id;else if(i.id!==t)return void s.enqueue({part:i,partialOutput:void 0});if("text-start"===i.type)return void s.enqueue({part:i,partialOutput:void 0});if("text-end"===i.type){r.length>0&&l({controller:s}),s.enqueue({part:i,partialOutput:void 0});return}o+=i.text,r+=i.text,a=null!=(u=i.providerMetadata)?u:a;let p=await e.parsePartialOutput({text:o});if(void 0!==p){let e=JSON.stringify(p.partial);e!==n&&(l({controller:s,partialOutput:p.partial}),n=e)}}})}(null!=w?w:tI())).pipeThrough(K);const{maxRetries:ee,retry:et}=tu({maxRetries:r,abortSignal:n}),ea=e5(t),eo=eD(o),er=e7({model:e,telemetry:t,headers:a,settings:{...eo,maxRetries:ee}}),en=this;e9({name:"ai.streamText",attributes:tt({telemetry:t,attributes:{...e2({operationId:"ai.streamText",telemetry:t}),...er,"ai.prompt":{input:()=>JSON.stringify({system:p,prompt:d,messages:c})}}}),tracer:ea,endWhenDone:!1,fn:async o=>{j=o;let r=await e1({system:p,prompt:d,messages:c}),h=r.messages,g=[],{approvedToolApprovals:z,deniedToolApprovals:E}=tp({messages:h});if(E.length>0||z.length>0){let e,a=[...z,...E].filter(e=>e.toolCall.providerExecuted),o=z.filter(e=>!e.toolCall.providerExecuted),r=E.filter(e=>!e.toolCall.providerExecuted),l=E.filter(e=>e.toolCall.providerExecuted),i=new ReadableStream({start(t){e=t}});en.addStream(i);try{for(let t of[...r,...l])null==e||e.enqueue({type:"tool-output-denied",toolCallId:t.toolCall.toolCallId,toolName:t.toolCall.toolName});let i=[];if(await Promise.all(o.map(async a=>{let o=await td({toolCall:a.toolCall,tools:m,tracer:ea,telemetry:t,messages:h,abortSignal:n,experimental_context:_,onPreliminaryToolResult:t=>{null==e||e.enqueue(t)}});null!=o&&(null==e||e.enqueue(o),i.push(o))})),a.length>0&&g.push({role:"tool",content:a.map(e=>({type:"tool-approval-response",approvalId:e.approvalResponse.approvalId,approved:e.approvalResponse.approved,reason:e.approvalResponse.reason,providerExecuted:!0}))}),i.length>0||r.length>0){let e=[];for(let t of i)e.push({type:"tool-result",toolCallId:t.toolCallId,toolName:t.toolName,output:await eq({toolCallId:t.toolCallId,input:t.input,tool:null==m?void 0:m[t.toolName],output:"tool-result"===t.type?t.output:t.error,errorMode:"tool-error"===t.type?"json":"none"})});for(let t of r)e.push({type:"tool-result",toolCallId:t.toolCall.toolCallId,toolName:t.toolCall.toolName,output:{type:"execution-denied",reason:t.approvalResponse.reason}});g.push({role:"tool",content:e})}}finally{null==e||e.close()}}async function S({currentStep:o,responseMessages:d,usage:c}){var g,z,E,R,M,N,j;let D,P=en.includeRawChunks,U=null!=l?setTimeout(()=>i.abort(),l):void 0;function F(){null!=D&&(clearTimeout(D),D=void 0)}function J(){null!=U&&clearTimeout(U)}try{let l,i,U;q=new f.e1;let L=[...h,...d],B=await (null==x?void 0:x({model:e,steps:W,stepNumber:W.length,messages:L,experimental_context:_})),V=ex(null!=(g=null==B?void 0:B.model)?g:e),Y=await e_({prompt:{system:null!=(z=null==B?void 0:B.system)?z:r.system,messages:null!=(E=null==B?void 0:B.messages)?E:L},supportedUrls:await V.supportedUrls,download:O}),{toolChoice:K,tools:Z}=await eP({tools:m,toolChoice:null!=(R=null==B?void 0:B.toolChoice)?R:v,activeTools:null!=(M=null==B?void 0:B.activeTools)?M:y});_=null!=(N=null==B?void 0:B.experimental_context)?N:_;let H=ti(T,null==B?void 0:B.providerOptions),{result:{stream:Q,response:X,request:ee},doStreamSpan:el,startTimestampMs:ei}=await et(()=>e9({name:"ai.streamText.doStream",attributes:tt({telemetry:t,attributes:{...e2({operationId:"ai.streamText.doStream",telemetry:t}),...er,"ai.model.provider":V.provider,"ai.model.id":V.modelId,"ai.prompt.messages":{input:()=>ta(Y)},"ai.prompt.tools":{input:()=>null==Z?void 0:Z.map(e=>JSON.stringify(e))},"ai.prompt.toolChoice":{input:()=>null!=K?JSON.stringify(K):void 0},"gen_ai.system":V.provider,"gen_ai.request.model":V.modelId,"gen_ai.request.frequency_penalty":eo.frequencyPenalty,"gen_ai.request.max_tokens":eo.maxOutputTokens,"gen_ai.request.presence_penalty":eo.presencePenalty,"gen_ai.request.stop_sequences":eo.stopSequences,"gen_ai.request.temperature":eo.temperature,"gen_ai.request.top_k":eo.topK,"gen_ai.request.top_p":eo.topP}}),tracer:ea,endWhenDone:!1,fn:async e=>({startTimestampMs:k(),doStreamSpan:e,result:await V.doStream({...eo,tools:Z,toolChoice:K,responseFormat:await (null==w?void 0:w.responseFormat),prompt:Y,providerOptions:H,abortSignal:n,headers:a,includeRawChunks:P})})})),es=function({tools:e,generatorStream:t,tracer:a,telemetry:o,system:r,messages:n,abortSignal:l,repairToolCall:i,experimental_context:s,generateId:u}){let p,d=null,c=new ReadableStream({start(e){d=e}}),m=new Set,v=new Map,h=new Map,g=!1;function y(){g&&0===m.size&&(null!=p&&d.enqueue(p),d.close())}let b=new TransformStream({async transform(t,c){let g=t.type;switch(g){case"stream-start":case"text-start":case"text-delta":case"text-end":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"tool-input-start":case"tool-input-delta":case"tool-input-end":case"source":case"response-metadata":case"error":case"raw":c.enqueue(t);break;case"file":c.enqueue({type:"file",file:new tv({data:t.data,mediaType:t.mediaType})});break;case"finish":p={type:"finish",finishReason:t.finishReason.unified,rawFinishReason:t.finishReason.raw,usage:to(t.usage),providerMetadata:t.providerMetadata};break;case"tool-approval-request":{let e=h.get(t.toolCallId);if(null==e){d.enqueue({type:"error",error:new $({toolCallId:t.toolCallId,approvalId:t.approvalId})});break}c.enqueue({type:"tool-approval-request",approvalId:t.approvalId,toolCall:e});break}case"tool-call":try{let p=await tk({toolCall:t,tools:e,repairToolCall:i,system:r,messages:n});if(h.set(p.toolCallId,p),c.enqueue(p),p.invalid){d.enqueue({type:"tool-error",toolCallId:p.toolCallId,toolName:p.toolName,input:p.input,error:(0,f.u1)(p.error),dynamic:!0,title:p.title});break}let g=null==e?void 0:e[p.toolName];if(null==g)break;if(null!=g.onInputAvailable&&await g.onInputAvailable({input:p.input,toolCallId:p.toolCallId,messages:n,abortSignal:l,experimental_context:s}),await tf({tool:g,toolCall:p,messages:n,experimental_context:s})){d.enqueue({type:"tool-approval-request",approvalId:u(),toolCall:p});break}if(v.set(p.toolCallId,p.input),null!=g.execute&&!0!==p.providerExecuted){let t=u();m.add(t),td({toolCall:p,tools:e,tracer:a,telemetry:o,messages:n,abortSignal:l,experimental_context:s,onPreliminaryToolResult:e=>{d.enqueue(e)}}).then(e=>{d.enqueue(e)}).catch(e=>{d.enqueue({type:"error",error:e})}).finally(()=>{m.delete(t),y()})}}catch(e){d.enqueue({type:"error",error:e})}break;case"tool-result":{let e=t.toolName;t.isError?d.enqueue({type:"tool-error",toolCallId:t.toolCallId,toolName:e,input:v.get(t.toolCallId),providerExecuted:!0,error:t.result,dynamic:t.dynamic}):c.enqueue({type:"tool-result",toolCallId:t.toolCallId,toolName:e,input:v.get(t.toolCallId),output:t.result,providerExecuted:!0,dynamic:t.dynamic});break}default:throw Error(`Unhandled chunk type: ${g}`)}},flush(){g=!0,y()}});return new ReadableStream({start:async e=>Promise.all([t.pipeThrough(b).pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){}})),c.pipeTo(new WritableStream({write(t){e.enqueue(t)},close(){e.close()}}))])})}({tools:m,generatorStream:Q,tracer:ea,telemetry:t,system:p,messages:L,repairToolCall:b,abortSignal:n,experimental_context:_,generateId:C}),eu=null==(j=null==A?void 0:A.requestBody)||j?null!=ee?ee:{}:{...ee,body:void 0},ep=[],ed=[],ec={},em="other",ev=tr(),ef=!0,eh={id:C(),timestamp:new Date,modelId:e.modelId},eg="";en.addStream(es.pipeThrough(new TransformStream({async transform(e,t){var a,o,r,p,d;if(null!=s&&(null!=D&&clearTimeout(D),D=setTimeout(()=>u.abort(),s)),"stream-start"===e.type){l=e.warnings;return}if(ef){let e=k()-ei;ef=!1,el.addEvent("ai.stream.firstChunk",{"ai.response.msToFirstChunk":e}),el.setAttributes({"ai.response.msToFirstChunk":e}),t.enqueue({type:"start-step",request:eu,warnings:null!=l?l:[]})}let c=e.type;switch(c){case"tool-approval-request":case"text-start":case"text-end":case"reasoning-start":case"reasoning-end":case"file":case"source":t.enqueue(e);break;case"text-delta":e.delta.length>0&&(t.enqueue({type:"text-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata}),eg+=e.delta);break;case"reasoning-delta":t.enqueue({type:"reasoning-delta",id:e.id,text:e.delta,providerMetadata:e.providerMetadata});break;case"tool-call":t.enqueue(e),ep.push(e);break;case"tool-result":t.enqueue(e),e.preliminary||ed.push(e);break;case"tool-error":t.enqueue(e),ed.push(e);break;case"response-metadata":eh={id:null!=(a=e.id)?a:eh.id,timestamp:null!=(o=e.timestamp)?o:eh.timestamp,modelId:null!=(r=e.modelId)?r:eh.modelId};break;case"finish":{ev=e.usage,em=e.finishReason,U=e.rawFinishReason,i=e.providerMetadata;let t=k()-ei;el.addEvent("ai.stream.finish"),el.setAttributes({"ai.response.msToFinish":t,"ai.response.avgOutputTokensPerSecond":1e3*(null!=(p=ev.outputTokens)?p:0)/t});break}case"tool-input-start":{ec[e.id]=e.toolName;let a=null==m?void 0:m[e.toolName];(null==a?void 0:a.onInputStart)!=null&&await a.onInputStart({toolCallId:e.id,messages:L,abortSignal:n,experimental_context:_}),t.enqueue({...e,dynamic:null!=(d=e.dynamic)?d:(null==a?void 0:a.type)==="dynamic",title:null==a?void 0:a.title});break}case"tool-input-end":delete ec[e.id],t.enqueue(e);break;case"tool-input-delta":{let a=ec[e.id],o=null==m?void 0:m[a];(null==o?void 0:o.onInputDelta)!=null&&await o.onInputDelta({inputTextDelta:e.delta,toolCallId:e.id,messages:L,abortSignal:n,experimental_context:_}),t.enqueue(e);break}case"error":t.enqueue(e),em="error";break;case"raw":P&&t.enqueue(e);break;default:throw Error(`Unknown chunk type: ${c}`)}},async flush(e){let a=ep.length>0?JSON.stringify(ep):void 0;try{el.setAttributes(await tt({telemetry:t,attributes:{"ai.response.finishReason":em,"ai.response.text":{output:()=>eg},"ai.response.toolCalls":{output:()=>a},"ai.response.id":eh.id,"ai.response.model":eh.modelId,"ai.response.timestamp":eh.timestamp.toISOString(),"ai.response.providerMetadata":JSON.stringify(i),"ai.usage.inputTokens":ev.inputTokens,"ai.usage.outputTokens":ev.outputTokens,"ai.usage.totalTokens":ev.totalTokens,"ai.usage.reasoningTokens":ev.reasoningTokens,"ai.usage.cachedInputTokens":ev.cachedInputTokens,"gen_ai.response.finish_reasons":[em],"gen_ai.response.id":eh.id,"gen_ai.response.model":eh.modelId,"gen_ai.usage.input_tokens":ev.inputTokens,"gen_ai.usage.output_tokens":ev.outputTokens}}))}catch(e){}finally{el.end()}e.enqueue({type:"finish-step",finishReason:em,rawFinishReason:U,usage:ev,providerMetadata:i,response:{...eh,headers:null==X?void 0:X.headers}});let r=tn(c,ev);await q.promise;let n=ep.filter(e=>!0!==e.providerExecuted),l=ed.filter(e=>!0!==e.providerExecuted);for(let e of ep){if(!0!==e.providerExecuted)continue;let t=null==m?void 0:m[e.toolName];(null==t?void 0:t.type)==="provider"&&t.supportsDeferredResults&&(ed.some(t=>("tool-result"===t.type||"tool-error"===t.type)&&t.toolCallId===e.toolCallId)||G.set(e.toolCallId,{toolName:e.toolName}))}for(let e of ed)("tool-result"===e.type||"tool-error"===e.type)&&G.delete(e.toolCallId);if(J(),F(),(n.length>0&&l.length===n.length||G.size>0)&&!await tM({stopConditions:I,steps:W})){d.push(...await tN({content:W[W.length-1].content,tools:m}));try{await S({currentStep:o+1,responseMessages:d,usage:r})}catch(t){e.enqueue({type:"error",error:t}),en.closeStream()}}else e.enqueue({type:"finish",finishReason:em,rawFinishReason:U,totalUsage:r}),en.closeStream()}})))}finally{J(),F()}}J.push(...g),await S({currentStep:0,responseMessages:g,usage:tr()})}}).catch(e=>{en.addStream(new ReadableStream({start(t){t.enqueue({type:"error",error:e}),t.close()}})),en.closeStream()})}get steps(){return this.consumeStream(),this._steps.promise}get finalStep(){return this.steps.then(e=>e[e.length-1])}get content(){return this.finalStep.then(e=>e.content)}get warnings(){return this.finalStep.then(e=>e.warnings)}get providerMetadata(){return this.finalStep.then(e=>e.providerMetadata)}get text(){return this.finalStep.then(e=>e.text)}get reasoningText(){return this.finalStep.then(e=>e.reasoningText)}get reasoning(){return this.finalStep.then(e=>e.reasoning)}get sources(){return this.finalStep.then(e=>e.sources)}get files(){return this.finalStep.then(e=>e.files)}get toolCalls(){return this.finalStep.then(e=>e.toolCalls)}get staticToolCalls(){return this.finalStep.then(e=>e.staticToolCalls)}get dynamicToolCalls(){return this.finalStep.then(e=>e.dynamicToolCalls)}get toolResults(){return this.finalStep.then(e=>e.toolResults)}get staticToolResults(){return this.finalStep.then(e=>e.staticToolResults)}get dynamicToolResults(){return this.finalStep.then(e=>e.dynamicToolResults)}get usage(){return this.finalStep.then(e=>e.usage)}get request(){return this.finalStep.then(e=>e.request)}get response(){return this.finalStep.then(e=>e.response)}get totalUsage(){return this.consumeStream(),this._totalUsage.promise}get finishReason(){return this.consumeStream(),this._finishReason.promise}get rawFinishReason(){return this.consumeStream(),this._rawFinishReason.promise}teeStream(){let[e,t]=this.baseStream.tee();return this.baseStream=t,e}get textStream(){return tY(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){"text-delta"===e.type&&t.enqueue(e.text)}})))}get fullStream(){return tY(this.teeStream().pipeThrough(new TransformStream({transform({part:e},t){t.enqueue(e)}})))}async consumeStream(e){var t;try{await tK({stream:this.fullStream,onError:null==e?void 0:e.onError})}catch(a){null==(t=null==e?void 0:e.onError)||t.call(e,a)}}get experimental_partialOutputStream(){return this.partialOutputStream}get partialOutputStream(){return tY(this.teeStream().pipeThrough(new TransformStream({transform({partialOutput:e},t){null!=e&&t.enqueue(e)}})))}get elementStream(){var e,t,a;let o=null==(e=this.outputSpecification)?void 0:e.createElementStreamTransform();if(null==o)throw new h.b8({functionality:`element streams in ${null!=(a=null==(t=this.outputSpecification)?void 0:t.name)?a:"text"} mode`});return tY(this.teeStream().pipeThrough(o))}get output(){return this.finalStep.then(e=>{var t;return(null!=(t=this.outputSpecification)?t:tI()).parseCompleteOutput({text:e.text},{response:e.response,usage:e.usage,finishReason:e.finishReason})})}toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:o,sendReasoning:r=!0,sendSources:n=!1,sendStart:l=!0,sendFinish:i=!0,onError:s=h.u1}={}){let u=null!=t?function({originalMessages:e,responseMessageId:t}){if(null==e)return;let a=e[e.length-1];return(null==a?void 0:a.role)==="assistant"?a.id:"function"==typeof t?t():t}({originalMessages:e,responseMessageId:t}):void 0,p=e=>{var t;let a=null==(t=this.tools)?void 0:t[e.toolName];return null==a?e.dynamic:(null==a?void 0:a.type)==="dynamic"||void 0};return tY(tV({stream:this.fullStream.pipeThrough(new TransformStream({transform:async(e,t)=>{let a=null==o?void 0:o({part:e}),d=e.type;switch(d){case"text-start":t.enqueue({type:"text-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-delta":t.enqueue({type:"text-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"text-end":t.enqueue({type:"text-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-start":t.enqueue({type:"reasoning-start",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-delta":r&&t.enqueue({type:"reasoning-delta",id:e.id,delta:e.text,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"reasoning-end":t.enqueue({type:"reasoning-end",id:e.id,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"file":t.enqueue({type:"file",mediaType:e.file.mediaType,url:`data:${e.file.mediaType};base64,${e.file.base64}`});break;case"source":n&&"url"===e.sourceType&&t.enqueue({type:"source-url",sourceId:e.id,url:e.url,title:e.title,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}}),n&&"document"===e.sourceType&&t.enqueue({type:"source-document",sourceId:e.id,mediaType:e.mediaType,title:e.title,filename:e.filename,...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{}});break;case"tool-input-start":{let a=p(e);t.enqueue({type:"tool-input-start",toolCallId:e.id,toolName:e.toolName,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=a?{dynamic:a}:{},...null!=e.title?{title:e.title}:{}});break}case"tool-input-delta":t.enqueue({type:"tool-input-delta",toolCallId:e.id,inputTextDelta:e.delta});break;case"tool-call":{let a=p(e);e.invalid?t.enqueue({type:"tool-input-error",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=a?{dynamic:a}:{},errorText:s(e.error),...null!=e.title?{title:e.title}:{}}):t.enqueue({type:"tool-input-available",toolCallId:e.toolCallId,toolName:e.toolName,input:e.input,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.providerMetadata?{providerMetadata:e.providerMetadata}:{},...null!=a?{dynamic:a}:{},...null!=e.title?{title:e.title}:{}});break}case"tool-approval-request":t.enqueue({type:"tool-approval-request",approvalId:e.approvalId,toolCallId:e.toolCall.toolCallId});break;case"tool-result":{let a=p(e);t.enqueue({type:"tool-output-available",toolCallId:e.toolCallId,output:e.output,...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=e.preliminary?{preliminary:e.preliminary}:{},...null!=a?{dynamic:a}:{}});break}case"tool-error":{let a=p(e);t.enqueue({type:"tool-output-error",toolCallId:e.toolCallId,errorText:s(e.error),...null!=e.providerExecuted?{providerExecuted:e.providerExecuted}:{},...null!=a?{dynamic:a}:{}});break}case"tool-output-denied":t.enqueue({type:"tool-output-denied",toolCallId:e.toolCallId});break;case"error":t.enqueue({type:"error",errorText:s(e.error)});break;case"start-step":t.enqueue({type:"start-step"});break;case"finish-step":t.enqueue({type:"finish-step"});break;case"start":l&&t.enqueue({type:"start",...null!=a?{messageMetadata:a}:{},...null!=u?{messageId:u}:{}});break;case"finish":i&&t.enqueue({type:"finish",finishReason:e.finishReason,...null!=a?{messageMetadata:a}:{}});break;case"abort":t.enqueue(e);break;case"tool-input-end":case"raw":break;default:throw Error(`Unknown chunk type: ${d}`)}null!=a&&"start"!==d&&"finish"!==d&&t.enqueue({type:"message-metadata",messageMetadata:a})}})),messageId:null!=u?u:null==t?void 0:t(),originalMessages:e,onFinish:a,onError:s}))}pipeUIMessageStreamToResponse(e,{originalMessages:t,generateMessageId:a,onFinish:o,messageMetadata:r,sendReasoning:n,sendSources:l,sendFinish:i,sendStart:s,onError:u,...p}={}){!function({response:e,status:t,statusText:a,headers:o,stream:r,consumeSseStream:n}){let l=r.pipeThrough(new tU);if(n){let[e,t]=l.tee();l=e,n({stream:t})}t$({response:e,status:t,statusText:a,headers:Object.fromEntries(tP(o,tF).entries()),stream:l.pipeThrough(new TextEncoderStream)})}({response:e,stream:this.toUIMessageStream({originalMessages:t,generateMessageId:a,onFinish:o,messageMetadata:r,sendReasoning:n,sendSources:l,sendFinish:i,sendStart:s,onError:u}),...p})}pipeTextStreamToResponse(e,t){!function({response:e,status:t,statusText:a,headers:o,textStream:r}){t$({response:e,status:t,statusText:a,headers:Object.fromEntries(tP(o,{"content-type":"text/plain; charset=utf-8"}).entries()),stream:r.pipeThrough(new TextEncoderStream)})}({response:e,textStream:this.textStream,...t})}toUIMessageStreamResponse({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:o,sendReasoning:r,sendSources:n,sendFinish:l,sendStart:i,onError:s,...u}={}){return tJ({stream:this.toUIMessageStream({originalMessages:e,generateMessageId:t,onFinish:a,messageMetadata:o,sendReasoning:r,sendSources:n,sendFinish:l,sendStart:i,onError:s}),...u})}toTextStreamResponse(e){return function({status:e,statusText:t,headers:a,textStream:o}){return new Response(o.pipeThrough(new TextEncoderStream),{status:null!=e?e:200,statusText:t,headers:tP(a,{"content-type":"text/plain; charset=utf-8"})})}({textStream:this.textStream,...e})}};function t1({execute:e,onError:t=f.u1,originalMessages:a,onFinish:o,generateId:r=f.$C}){let n,l=[],i=new ReadableStream({start(e){n=e}});function s(e){try{n.enqueue(e)}catch(e){}}try{let a=e({writer:{write(e){s(e)},merge(e){l.push((async()=>{let t=e.getReader();for(;;){let{done:e,value:a}=await t.read();if(e)break;s(a)}})().catch(e=>{s({type:"error",errorText:t(e)})}))},onError:t}});a&&l.push(a.catch(e=>{s({type:"error",errorText:t(e)})}))}catch(e){s({type:"error",errorText:t(e)})}return new Promise(async e=>{for(;l.length>0;)await l.shift();e()}).finally(()=>{try{n.close()}catch(e){}}),tV({stream:i,messageId:r(),originalMessages:a,onFinish:o,onError:t})}(0,f.ID)(()=>(0,f.jN)(y.z.array(y.z.object({id:y.z.string(),role:y.z.enum(["system","user","assistant"]),metadata:y.z.unknown().optional(),parts:y.z.array(y.z.union([y.z.object({type:y.z.literal("text"),text:y.z.string(),state:y.z.enum(["streaming","done"]).optional(),providerMetadata:eU.optional()}),y.z.object({type:y.z.literal("reasoning"),text:y.z.string(),state:y.z.enum(["streaming","done"]).optional(),providerMetadata:eU.optional()}),y.z.object({type:y.z.literal("source-url"),sourceId:y.z.string(),url:y.z.string(),title:y.z.string().optional(),providerMetadata:eU.optional()}),y.z.object({type:y.z.literal("source-document"),sourceId:y.z.string(),mediaType:y.z.string(),title:y.z.string(),filename:y.z.string().optional(),providerMetadata:eU.optional()}),y.z.object({type:y.z.literal("file"),mediaType:y.z.string(),filename:y.z.string().optional(),url:y.z.string(),providerMetadata:eU.optional()}),y.z.object({type:y.z.literal("step-start")}),y.z.object({type:y.z.string().startsWith("data-"),id:y.z.string().optional(),data:y.z.unknown()}),y.z.object({type:y.z.literal("dynamic-tool"),toolName:y.z.string(),toolCallId:y.z.string(),state:y.z.literal("input-streaming"),input:y.z.unknown().optional(),providerExecuted:y.z.boolean().optional(),callProviderMetadata:eU.optional(),output:y.z.never().optional(),errorText:y.z.never().optional(),approval:y.z.never().optional()}),y.z.object({type:y.z.literal("dynamic-tool"),toolName:y.z.string(),toolCallId:y.z.string(),state:y.z.literal("input-available"),input:y.z.unknown(),providerExecuted:y.z.boolean().optional(),output:y.z.never().optional(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),approval:y.z.never().optional()}),y.z.object({type:y.z.literal("dynamic-tool"),toolName:y.z.string(),toolCallId:y.z.string(),state:y.z.literal("approval-requested"),input:y.z.unknown(),providerExecuted:y.z.boolean().optional(),output:y.z.never().optional(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),approval:y.z.object({id:y.z.string(),approved:y.z.never().optional(),reason:y.z.never().optional()})}),y.z.object({type:y.z.literal("dynamic-tool"),toolName:y.z.string(),toolCallId:y.z.string(),state:y.z.literal("approval-responded"),input:y.z.unknown(),providerExecuted:y.z.boolean().optional(),output:y.z.never().optional(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),approval:y.z.object({id:y.z.string(),approved:y.z.boolean(),reason:y.z.string().optional()})}),y.z.object({type:y.z.literal("dynamic-tool"),toolName:y.z.string(),toolCallId:y.z.string(),state:y.z.literal("output-available"),input:y.z.unknown(),providerExecuted:y.z.boolean().optional(),output:y.z.unknown(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),preliminary:y.z.boolean().optional(),approval:y.z.object({id:y.z.string(),approved:y.z.literal(!0),reason:y.z.string().optional()}).optional()}),y.z.object({type:y.z.literal("dynamic-tool"),toolName:y.z.string(),toolCallId:y.z.string(),state:y.z.literal("output-error"),input:y.z.unknown(),rawInput:y.z.unknown().optional(),providerExecuted:y.z.boolean().optional(),output:y.z.never().optional(),errorText:y.z.string(),callProviderMetadata:eU.optional(),approval:y.z.object({id:y.z.string(),approved:y.z.literal(!0),reason:y.z.string().optional()}).optional()}),y.z.object({type:y.z.literal("dynamic-tool"),toolName:y.z.string(),toolCallId:y.z.string(),state:y.z.literal("output-denied"),input:y.z.unknown(),providerExecuted:y.z.boolean().optional(),output:y.z.never().optional(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),approval:y.z.object({id:y.z.string(),approved:y.z.literal(!1),reason:y.z.string().optional()})}),y.z.object({type:y.z.string().startsWith("tool-"),toolCallId:y.z.string(),state:y.z.literal("input-streaming"),providerExecuted:y.z.boolean().optional(),callProviderMetadata:eU.optional(),input:y.z.unknown().optional(),output:y.z.never().optional(),errorText:y.z.never().optional(),approval:y.z.never().optional()}),y.z.object({type:y.z.string().startsWith("tool-"),toolCallId:y.z.string(),state:y.z.literal("input-available"),providerExecuted:y.z.boolean().optional(),input:y.z.unknown(),output:y.z.never().optional(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),approval:y.z.never().optional()}),y.z.object({type:y.z.string().startsWith("tool-"),toolCallId:y.z.string(),state:y.z.literal("approval-requested"),input:y.z.unknown(),providerExecuted:y.z.boolean().optional(),output:y.z.never().optional(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),approval:y.z.object({id:y.z.string(),approved:y.z.never().optional(),reason:y.z.never().optional()})}),y.z.object({type:y.z.string().startsWith("tool-"),toolCallId:y.z.string(),state:y.z.literal("approval-responded"),input:y.z.unknown(),providerExecuted:y.z.boolean().optional(),output:y.z.never().optional(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),approval:y.z.object({id:y.z.string(),approved:y.z.boolean(),reason:y.z.string().optional()})}),y.z.object({type:y.z.string().startsWith("tool-"),toolCallId:y.z.string(),state:y.z.literal("output-available"),providerExecuted:y.z.boolean().optional(),input:y.z.unknown(),output:y.z.unknown(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),preliminary:y.z.boolean().optional(),approval:y.z.object({id:y.z.string(),approved:y.z.literal(!0),reason:y.z.string().optional()}).optional()}),y.z.object({type:y.z.string().startsWith("tool-"),toolCallId:y.z.string(),state:y.z.literal("output-error"),providerExecuted:y.z.boolean().optional(),input:y.z.unknown(),rawInput:y.z.unknown().optional(),output:y.z.never().optional(),errorText:y.z.string(),callProviderMetadata:eU.optional(),approval:y.z.object({id:y.z.string(),approved:y.z.literal(!0),reason:y.z.string().optional()}).optional()}),y.z.object({type:y.z.string().startsWith("tool-"),toolCallId:y.z.string(),state:y.z.literal("output-denied"),providerExecuted:y.z.boolean().optional(),input:y.z.unknown(),output:y.z.never().optional(),errorText:y.z.never().optional(),callProviderMetadata:eU.optional(),approval:y.z.object({id:y.z.string(),approved:y.z.literal(!1),reason:y.z.string().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty"))),(0,f.hK)({prefix:"aiobj",size:24}),(0,f.hK)({prefix:"aiobj",size:24});Symbol.for("vercel.ai.error.AI_NoSuchProviderError");h.eM;var t8=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:o,fetch:r,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:l}){this.api=e,this.credentials=t,this.headers=a,this.body=o,this.fetch=r,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=l}async sendMessages({abortSignal:e,...t}){var a,o,r,n,l;let i=await (0,f.hd)(this.body),s=await (0,f.hd)(this.headers),u=await (0,f.hd)(this.credentials),p={...(0,f.qx)(s),...(0,f.qx)(t.headers)},d=await (null==(a=this.prepareSendMessagesRequest)?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...i,...t.body},headers:p,credentials:u,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),c=null!=(o=null==d?void 0:d.api)?o:this.api,m=(null==d?void 0:d.headers)!==void 0?(0,f.qx)(d.headers):p,v=(null==d?void 0:d.body)!==void 0?d.body:{...i,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},h=null!=(r=null==d?void 0:d.credentials)?r:u,g=null!=(n=this.fetch)?n:globalThis.fetch,y=await g(c,{method:"POST",headers:(0,f.WZ)({"Content-Type":"application/json",...m},`ai-sdk/${eE}`,(0,f.G1)()),body:JSON.stringify(v),credentials:h,signal:e});if(!y.ok)throw Error(null!=(l=await y.text())?l:"Failed to fetch the chat response.");if(!y.body)throw Error("The response body is empty.");return this.processResponseStream(y.body)}async reconnectToStream(e){var t,a,o,r,n;let l=await (0,f.hd)(this.body),i=await (0,f.hd)(this.headers),s=await (0,f.hd)(this.credentials),u={...(0,f.qx)(i),...(0,f.qx)(e.headers)},p=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...l,...e.body},headers:u,credentials:s,requestMetadata:e.metadata})),d=null!=(a=null==p?void 0:p.api)?a:`${this.api}/${e.chatId}/stream`,c=(null==p?void 0:p.headers)!==void 0?(0,f.qx)(p.headers):u,m=null!=(o=null==p?void 0:p.credentials)?o:s,v=null!=(r=this.fetch)?r:globalThis.fetch,h=await v(d,{method:"GET",headers:(0,f.WZ)(c,`ai-sdk/${eE}`,(0,f.G1)()),credentials:m});if(204===h.status)return null;if(!h.ok)throw Error(null!=(n=await h.text())?n:"Failed to fetch the chat response.");if(!h.body)throw Error("The response body is empty.");return this.processResponseStream(h.body)}},t2=class extends t8{constructor(e={}){super(e)}processResponseStream(e){return(0,f._Z)({stream:e,schema:tL}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}}}}]);