"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1971],{76973:(e,t,a)=>{a.d(t,{vl:()=>X});var r,o,s=a(53127),i=a(98162),n=a(30929);a(40459);var l=Object.defineProperty,p=Symbol.for("vercel.ai.error.AI_InvalidArgumentError");i.bD;Symbol.for("vercel.ai.error.AI_InvalidStreamPartError");i.bD;Symbol.for("vercel.ai.error.AI_InvalidToolApprovalError");i.bD;Symbol.for("vercel.ai.error.AI_InvalidToolInputError");i.bD;Symbol.for("vercel.ai.error.AI_ToolCallNotFoundForApprovalError");i.bD;Symbol.for("vercel.ai.error.AI_MissingToolResultsError");i.bD;Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");i.bD;var d="AI_NoObjectGeneratedError",u=`vercel.ai.error.${d}`,c=Symbol.for(u),m=class extends i.bD{constructor({message:e="No object generated.",cause:t,text:a,response:o,usage:s,finishReason:i}){super({name:d,message:e,cause:t}),this[r]=!0,this.text=a,this.response=o,this.usage=s,this.finishReason=i}static isInstance(e){return i.bD.hasMarker(e,u)}};r=c;Symbol.for("vercel.ai.error.AI_NoOutputGeneratedError");i.bD;Symbol.for("vercel.ai.error.AI_NoSpeechGeneratedError");i.bD;Symbol.for("vercel.ai.error.AI_NoTranscriptGeneratedError");i.bD;Symbol.for("vercel.ai.error.AI_NoVideoGeneratedError");i.bD;Symbol.for("vercel.ai.error.AI_NoSuchToolError");i.bD;Symbol.for("vercel.ai.error.AI_ToolCallRepairError");i.bD,i.bD;var h="AI_UIMessageStreamError",g=`vercel.ai.error.${h}`,z=Symbol.for(g),v=class extends i.bD{constructor({chunkType:e,chunkId:t,message:a}){super({name:h,message:a}),this[o]=!0,this.chunkType=e,this.chunkId=t}static isInstance(e){return i.bD.hasMarker(e,g)}};o=z;Symbol.for("vercel.ai.error.AI_InvalidDataContentError");i.bD;Symbol.for("vercel.ai.error.AI_InvalidMessageRoleError");i.bD;Symbol.for("vercel.ai.error.AI_MessageConversionError");i.bD;Symbol.for("vercel.ai.error.AI_RetryError");i.bD;var b="6.0.73",y=n.z.union([n.z.string(),n.z.instanceof(Uint8Array),n.z.instanceof(ArrayBuffer),n.z.custom(e=>{var t,a;return null!=(a=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&a},{message:"Must be a Buffer"})]),I=n.z.lazy(()=>n.z.union([n.z.null(),n.z.string(),n.z.number(),n.z.boolean(),n.z.record(n.z.string(),I.optional()),n.z.array(I)])),f=n.z.record(n.z.string(),n.z.record(n.z.string(),I.optional())),E=n.z.object({type:n.z.literal("text"),text:n.z.string(),providerOptions:f.optional()}),x=n.z.object({type:n.z.literal("image"),image:n.z.union([y,n.z.instanceof(URL)]),mediaType:n.z.string().optional(),providerOptions:f.optional()}),T=n.z.object({type:n.z.literal("file"),data:n.z.union([y,n.z.instanceof(URL)]),filename:n.z.string().optional(),mediaType:n.z.string(),providerOptions:f.optional()}),w=n.z.object({type:n.z.literal("reasoning"),text:n.z.string(),providerOptions:f.optional()}),R=n.z.object({type:n.z.literal("tool-call"),toolCallId:n.z.string(),toolName:n.z.string(),input:n.z.unknown(),providerOptions:f.optional(),providerExecuted:n.z.boolean().optional()}),M=n.z.discriminatedUnion("type",[n.z.object({type:n.z.literal("text"),value:n.z.string(),providerOptions:f.optional()}),n.z.object({type:n.z.literal("json"),value:I,providerOptions:f.optional()}),n.z.object({type:n.z.literal("execution-denied"),reason:n.z.string().optional(),providerOptions:f.optional()}),n.z.object({type:n.z.literal("error-text"),value:n.z.string(),providerOptions:f.optional()}),n.z.object({type:n.z.literal("error-json"),value:I,providerOptions:f.optional()}),n.z.object({type:n.z.literal("content"),value:n.z.array(n.z.union([n.z.object({type:n.z.literal("text"),text:n.z.string(),providerOptions:f.optional()}),n.z.object({type:n.z.literal("media"),data:n.z.string(),mediaType:n.z.string()}),n.z.object({type:n.z.literal("file-data"),data:n.z.string(),mediaType:n.z.string(),filename:n.z.string().optional(),providerOptions:f.optional()}),n.z.object({type:n.z.literal("file-url"),url:n.z.string(),providerOptions:f.optional()}),n.z.object({type:n.z.literal("file-id"),fileId:n.z.union([n.z.string(),n.z.record(n.z.string(),n.z.string())]),providerOptions:f.optional()}),n.z.object({type:n.z.literal("image-data"),data:n.z.string(),mediaType:n.z.string(),providerOptions:f.optional()}),n.z.object({type:n.z.literal("image-url"),url:n.z.string(),providerOptions:f.optional()}),n.z.object({type:n.z.literal("image-file-id"),fileId:n.z.union([n.z.string(),n.z.record(n.z.string(),n.z.string())]),providerOptions:f.optional()}),n.z.object({type:n.z.literal("custom"),providerOptions:f.optional()})]))})]),_=n.z.object({type:n.z.literal("tool-result"),toolCallId:n.z.string(),toolName:n.z.string(),output:M,providerOptions:f.optional()}),A=n.z.object({type:n.z.literal("tool-approval-request"),approvalId:n.z.string(),toolCallId:n.z.string()}),k=n.z.object({type:n.z.literal("tool-approval-response"),approvalId:n.z.string(),approved:n.z.boolean(),reason:n.z.string().optional()}),j=n.z.object({role:n.z.literal("system"),content:n.z.string(),providerOptions:f.optional()}),N=n.z.object({role:n.z.literal("user"),content:n.z.union([n.z.string(),n.z.array(n.z.union([E,x,T]))]),providerOptions:f.optional()}),S=n.z.object({role:n.z.literal("assistant"),content:n.z.union([n.z.string(),n.z.array(n.z.union([E,T,w,R,_,A]))]),providerOptions:f.optional()}),C=n.z.object({role:n.z.literal("tool"),content:n.z.array(n.z.union([_,k])),providerOptions:f.optional()});n.z.union([j,N,S,C]);var O={},D={array:()=>L,choice:()=>U,json:()=>W,object:()=>B,text:()=>q};for(var P in D)l(O,P,{get:D[P],enumerable:!0});async function F(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=await (0,s.N8)({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=await (0,s.N8)({text:function(e){let t=["ROOT"],a=-1,r=null;function o(e,o,s){switch(e){case'"':a=o,t.pop(),t.push(s),t.push("INSIDE_STRING");break;case"f":case"t":case"n":a=o,r=o,t.pop(),t.push(s),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=o,t.pop(),t.push(s),t.push("INSIDE_NUMBER");break;case"{":a=o,t.pop(),t.push(s),t.push("INSIDE_OBJECT_START");break;case"[":a=o,t.pop(),t.push(s),t.push("INSIDE_ARRAY_START")}}function s(e,r){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=r,t.pop()}}function i(e,r){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=r,t.pop()}}for(let n=0;n<e.length;n++){let l=e[n];switch(t[t.length-1]){case"ROOT":o(l,n,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":a=n,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":o(l,n,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":s(l,n);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),a=n;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:a=n}break;case"INSIDE_ARRAY_START":"]"===l?(a=n,t.pop()):(a=n,o(l,n,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=n,t.pop();break;default:a=n}break;case"INSIDE_ARRAY_AFTER_COMMA":o(l,n,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),a=n;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=n;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,n);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&s(l,n);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n);break;default:t.pop()}break;case"INSIDE_LITERAL":{let o=e.substring(r,n+1);"false".startsWith(o)||"true".startsWith(o)||"null".startsWith(o)?a=n:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?s(l,n):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,n))}}}let n=e.slice(0,a+1);for(let a=t.length-1;a>=0;a--)switch(t[a]){case"INSIDE_STRING":n+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":n+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":n+="]";break;case"INSIDE_LITERAL":{let t=e.substring(r,e.length);"true".startsWith(t)?n+="true".slice(t.length):"false".startsWith(t)?n+="false".slice(t.length):"null".startsWith(t)&&(n+="null".slice(t.length))}}return n}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}var q=()=>({name:"text",responseFormat:Promise.resolve({type:"text"}),parseCompleteOutput:async({text:e})=>e,parsePartialOutput:async({text:e})=>({partial:e}),createElementStreamTransform(){}}),B=({schema:e,name:t,description:a})=>{let r=(0,s.mD)(e);return{name:"object",responseFormat:(0,s.hd)(r.jsonSchema).then(e=>({type:"json",schema:e,...null!=t&&{name:t},...null!=a&&{description:a}})),async parseCompleteOutput({text:e},t){let a=await (0,s.N8)({text:e});if(!a.success)throw new m({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let o=await (0,s.ZZ)({value:a.value,schema:r});if(!o.success)throw new m({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return o.value},async parsePartialOutput({text:e}){let t=await F(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value}}},createElementStreamTransform(){}}},L=({element:e,name:t,description:a})=>{let r=(0,s.mD)(e);return{name:"array",responseFormat:(0,s.hd)(r.jsonSchema).then(e=>{let{$schema:r,...o}=e;return{type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{elements:{type:"array",items:o}},required:["elements"],additionalProperties:!1},...null!=t&&{name:t},...null!=a&&{description:a}}}),async parseCompleteOutput({text:e},t){let a=await (0,s.N8)({text:e});if(!a.success)throw new m({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});let o=a.value;if(null==o||"object"!=typeof o||!("elements"in o)||!Array.isArray(o.elements))throw new m({message:"No object generated: response did not match schema.",cause:new i.iM({value:o,cause:"response must be an object with an elements array"}),text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});for(let a of o.elements){let o=await (0,s.ZZ)({value:a,schema:r});if(!o.success)throw new m({message:"No object generated: response did not match schema.",cause:o.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason})}return o.elements},async parsePartialOutput({text:e}){let t=await F(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{let e=t.value;if(null==e||"object"!=typeof e||!("elements"in e)||!Array.isArray(e.elements))return;let a="repaired-parse"===t.state&&e.elements.length>0?e.elements.slice(0,-1):e.elements,o=[];for(let e of a){let t=await (0,s.ZZ)({value:e,schema:r});t.success&&o.push(t.value)}return{partial:o}}}},createElementStreamTransform(){let e=0;return new TransformStream({transform({partialOutput:t},a){if(null!=t)for(;e<t.length;e++)a.enqueue(t[e])}})}}},U=({options:e,name:t,description:a})=>({name:"choice",responseFormat:Promise.resolve({type:"json",schema:{$schema:"http://json-schema.org/draft-07/schema#",type:"object",properties:{result:{type:"string",enum:e}},required:["result"],additionalProperties:!1},...null!=t&&{name:t},...null!=a&&{description:a}}),async parseCompleteOutput({text:t},a){let r=await (0,s.N8)({text:t});if(!r.success)throw new m({message:"No object generated: could not parse the response.",cause:r.error,text:t,response:a.response,usage:a.usage,finishReason:a.finishReason});let o=r.value;if(null==o||"object"!=typeof o||!("result"in o)||"string"!=typeof o.result||!e.includes(o.result))throw new m({message:"No object generated: response did not match schema.",cause:new i.iM({value:o,cause:"response must be an object that contains a choice value."}),text:t,response:a.response,usage:a.usage,finishReason:a.finishReason});return o.result},async parsePartialOutput({text:t}){let a=await F(t);switch(a.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":{let t=a.value;if(null==t||"object"!=typeof t||!("result"in t)||"string"!=typeof t.result)return;let r=e.filter(e=>e.startsWith(t.result));if("successful-parse"===a.state)return r.includes(t.result)?{partial:t.result}:void 0;return 1===r.length?{partial:r[0]}:void 0}}},createElementStreamTransform(){}}),W=({name:e,description:t}={})=>({name:"json",responseFormat:Promise.resolve({type:"json",...null!=e&&{name:e},...null!=t&&{description:t}}),async parseCompleteOutput({text:e},t){let a=await (0,s.N8)({text:e});if(!a.success)throw new m({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:t.response,usage:t.usage,finishReason:t.finishReason});return a.value},async parsePartialOutput({text:e}){let t=await F(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return void 0===t.value?void 0:{partial:t.value}}},createElementStreamTransform(){}});(0,s.hK)({prefix:"aitxt",size:24}),TransformStream;var J=(0,s.ID)(()=>(0,s.jN)(n.z.union([n.z.strictObject({type:n.z.literal("text-start"),id:n.z.string(),providerMetadata:f.optional()}),n.z.strictObject({type:n.z.literal("text-delta"),id:n.z.string(),delta:n.z.string(),providerMetadata:f.optional()}),n.z.strictObject({type:n.z.literal("text-end"),id:n.z.string(),providerMetadata:f.optional()}),n.z.strictObject({type:n.z.literal("error"),errorText:n.z.string()}),n.z.strictObject({type:n.z.literal("tool-input-start"),toolCallId:n.z.string(),toolName:n.z.string(),providerExecuted:n.z.boolean().optional(),providerMetadata:f.optional(),dynamic:n.z.boolean().optional(),title:n.z.string().optional()}),n.z.strictObject({type:n.z.literal("tool-input-delta"),toolCallId:n.z.string(),inputTextDelta:n.z.string()}),n.z.strictObject({type:n.z.literal("tool-input-available"),toolCallId:n.z.string(),toolName:n.z.string(),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),providerMetadata:f.optional(),dynamic:n.z.boolean().optional(),title:n.z.string().optional()}),n.z.strictObject({type:n.z.literal("tool-input-error"),toolCallId:n.z.string(),toolName:n.z.string(),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),providerMetadata:f.optional(),dynamic:n.z.boolean().optional(),errorText:n.z.string(),title:n.z.string().optional()}),n.z.strictObject({type:n.z.literal("tool-approval-request"),approvalId:n.z.string(),toolCallId:n.z.string()}),n.z.strictObject({type:n.z.literal("tool-output-available"),toolCallId:n.z.string(),output:n.z.unknown(),providerExecuted:n.z.boolean().optional(),dynamic:n.z.boolean().optional(),preliminary:n.z.boolean().optional()}),n.z.strictObject({type:n.z.literal("tool-output-error"),toolCallId:n.z.string(),errorText:n.z.string(),providerExecuted:n.z.boolean().optional(),dynamic:n.z.boolean().optional()}),n.z.strictObject({type:n.z.literal("tool-output-denied"),toolCallId:n.z.string()}),n.z.strictObject({type:n.z.literal("reasoning-start"),id:n.z.string(),providerMetadata:f.optional()}),n.z.strictObject({type:n.z.literal("reasoning-delta"),id:n.z.string(),delta:n.z.string(),providerMetadata:f.optional()}),n.z.strictObject({type:n.z.literal("reasoning-end"),id:n.z.string(),providerMetadata:f.optional()}),n.z.strictObject({type:n.z.literal("source-url"),sourceId:n.z.string(),url:n.z.string(),title:n.z.string().optional(),providerMetadata:f.optional()}),n.z.strictObject({type:n.z.literal("source-document"),sourceId:n.z.string(),mediaType:n.z.string(),title:n.z.string(),filename:n.z.string().optional(),providerMetadata:f.optional()}),n.z.strictObject({type:n.z.literal("file"),url:n.z.string(),mediaType:n.z.string(),providerMetadata:f.optional()}),n.z.strictObject({type:n.z.custom(e=>"string"==typeof e&&e.startsWith("data-"),{message:'Type must start with "data-"'}),id:n.z.string().optional(),data:n.z.unknown(),transient:n.z.boolean().optional()}),n.z.strictObject({type:n.z.literal("start-step")}),n.z.strictObject({type:n.z.literal("finish-step")}),n.z.strictObject({type:n.z.literal("start"),messageId:n.z.string().optional(),messageMetadata:n.z.unknown().optional()}),n.z.strictObject({type:n.z.literal("finish"),finishReason:n.z.enum(["stop","length","content-filter","tool-calls","error","other"]).optional(),messageMetadata:n.z.unknown().optional()}),n.z.strictObject({type:n.z.literal("abort"),reason:n.z.string().optional()}),n.z.strictObject({type:n.z.literal("message-metadata"),messageMetadata:n.z.unknown()})])));function Y(e){return e.type.startsWith("tool-")}function $(e){return Y(e)||"dynamic-tool"===e.type}function V(e){return e.type.split("-").slice(1).join("-")}async function G({stream:e,onError:t}){let a=e.getReader();try{for(;;){let{done:e}=await a.read();if(e)break}}catch(e){null==t||t(e)}finally{a.releaseLock()}}(0,s.hK)({prefix:"aitxt",size:24}),(0,s.ID)(()=>(0,s.jN)(n.z.array(n.z.object({id:n.z.string(),role:n.z.enum(["system","user","assistant"]),metadata:n.z.unknown().optional(),parts:n.z.array(n.z.union([n.z.object({type:n.z.literal("text"),text:n.z.string(),state:n.z.enum(["streaming","done"]).optional(),providerMetadata:f.optional()}),n.z.object({type:n.z.literal("reasoning"),text:n.z.string(),state:n.z.enum(["streaming","done"]).optional(),providerMetadata:f.optional()}),n.z.object({type:n.z.literal("source-url"),sourceId:n.z.string(),url:n.z.string(),title:n.z.string().optional(),providerMetadata:f.optional()}),n.z.object({type:n.z.literal("source-document"),sourceId:n.z.string(),mediaType:n.z.string(),title:n.z.string(),filename:n.z.string().optional(),providerMetadata:f.optional()}),n.z.object({type:n.z.literal("file"),mediaType:n.z.string(),filename:n.z.string().optional(),url:n.z.string(),providerMetadata:f.optional()}),n.z.object({type:n.z.literal("step-start")}),n.z.object({type:n.z.string().startsWith("data-"),id:n.z.string().optional(),data:n.z.unknown()}),n.z.object({type:n.z.literal("dynamic-tool"),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal("input-streaming"),input:n.z.unknown().optional(),providerExecuted:n.z.boolean().optional(),callProviderMetadata:f.optional(),output:n.z.never().optional(),errorText:n.z.never().optional(),approval:n.z.never().optional()}),n.z.object({type:n.z.literal("dynamic-tool"),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal("input-available"),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),approval:n.z.never().optional()}),n.z.object({type:n.z.literal("dynamic-tool"),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal("approval-requested"),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),approval:n.z.object({id:n.z.string(),approved:n.z.never().optional(),reason:n.z.never().optional()})}),n.z.object({type:n.z.literal("dynamic-tool"),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal("approval-responded"),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),approval:n.z.object({id:n.z.string(),approved:n.z.boolean(),reason:n.z.string().optional()})}),n.z.object({type:n.z.literal("dynamic-tool"),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal("output-available"),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),output:n.z.unknown(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),preliminary:n.z.boolean().optional(),approval:n.z.object({id:n.z.string(),approved:n.z.literal(!0),reason:n.z.string().optional()}).optional()}),n.z.object({type:n.z.literal("dynamic-tool"),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal("output-error"),input:n.z.unknown(),rawInput:n.z.unknown().optional(),providerExecuted:n.z.boolean().optional(),output:n.z.never().optional(),errorText:n.z.string(),callProviderMetadata:f.optional(),approval:n.z.object({id:n.z.string(),approved:n.z.literal(!0),reason:n.z.string().optional()}).optional()}),n.z.object({type:n.z.literal("dynamic-tool"),toolName:n.z.string(),toolCallId:n.z.string(),state:n.z.literal("output-denied"),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),approval:n.z.object({id:n.z.string(),approved:n.z.literal(!1),reason:n.z.string().optional()})}),n.z.object({type:n.z.string().startsWith("tool-"),toolCallId:n.z.string(),state:n.z.literal("input-streaming"),providerExecuted:n.z.boolean().optional(),callProviderMetadata:f.optional(),input:n.z.unknown().optional(),output:n.z.never().optional(),errorText:n.z.never().optional(),approval:n.z.never().optional()}),n.z.object({type:n.z.string().startsWith("tool-"),toolCallId:n.z.string(),state:n.z.literal("input-available"),providerExecuted:n.z.boolean().optional(),input:n.z.unknown(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),approval:n.z.never().optional()}),n.z.object({type:n.z.string().startsWith("tool-"),toolCallId:n.z.string(),state:n.z.literal("approval-requested"),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),approval:n.z.object({id:n.z.string(),approved:n.z.never().optional(),reason:n.z.never().optional()})}),n.z.object({type:n.z.string().startsWith("tool-"),toolCallId:n.z.string(),state:n.z.literal("approval-responded"),input:n.z.unknown(),providerExecuted:n.z.boolean().optional(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),approval:n.z.object({id:n.z.string(),approved:n.z.boolean(),reason:n.z.string().optional()})}),n.z.object({type:n.z.string().startsWith("tool-"),toolCallId:n.z.string(),state:n.z.literal("output-available"),providerExecuted:n.z.boolean().optional(),input:n.z.unknown(),output:n.z.unknown(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),preliminary:n.z.boolean().optional(),approval:n.z.object({id:n.z.string(),approved:n.z.literal(!0),reason:n.z.string().optional()}).optional()}),n.z.object({type:n.z.string().startsWith("tool-"),toolCallId:n.z.string(),state:n.z.literal("output-error"),providerExecuted:n.z.boolean().optional(),input:n.z.unknown(),rawInput:n.z.unknown().optional(),output:n.z.never().optional(),errorText:n.z.string(),callProviderMetadata:f.optional(),approval:n.z.object({id:n.z.string(),approved:n.z.literal(!0),reason:n.z.string().optional()}).optional()}),n.z.object({type:n.z.string().startsWith("tool-"),toolCallId:n.z.string(),state:n.z.literal("output-denied"),providerExecuted:n.z.boolean().optional(),input:n.z.unknown(),output:n.z.never().optional(),errorText:n.z.never().optional(),callProviderMetadata:f.optional(),approval:n.z.object({id:n.z.string(),approved:n.z.literal(!1),reason:n.z.string().optional()})})])).nonempty("Message must contain at least one part")})).nonempty("Messages array must not be empty"))),(0,s.hK)({prefix:"aiobj",size:24});var K=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(e){return new Promise((t,a)=>{this.queue.push(async()=>{try{await e(),t()}catch(e){a(e)}}),this.processQueue()})}};(0,s.hK)({prefix:"aiobj",size:24});Symbol.for("vercel.ai.error.AI_NoSuchProviderError");async function Z(e){if(null==e)return[];if(!globalThis.FileList||!(e instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(e).map(async e=>{let{name:t,type:a}=e;return{type:"file",mediaType:a,filename:t,url:await new Promise((t,a)=>{let r=new FileReader;r.onload=e=>{var a;t(null==(a=e.target)?void 0:a.result)},r.onerror=e=>a(e),r.readAsDataURL(e)})}}))}i.eM;var Q=class{constructor({api:e="/api/chat",credentials:t,headers:a,body:r,fetch:o,prepareSendMessagesRequest:s,prepareReconnectToStreamRequest:i}){this.api=e,this.credentials=t,this.headers=a,this.body=r,this.fetch=o,this.prepareSendMessagesRequest=s,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:e,...t}){var a,r,o,i,n;let l=await (0,s.hd)(this.body),p=await (0,s.hd)(this.headers),d=await (0,s.hd)(this.credentials),u={...(0,s.qx)(p),...(0,s.qx)(t.headers)},c=await (null==(a=this.prepareSendMessagesRequest)?void 0:a.call(this,{api:this.api,id:t.chatId,messages:t.messages,body:{...l,...t.body},headers:u,credentials:d,requestMetadata:t.metadata,trigger:t.trigger,messageId:t.messageId})),m=null!=(r=null==c?void 0:c.api)?r:this.api,h=(null==c?void 0:c.headers)!==void 0?(0,s.qx)(c.headers):u,g=(null==c?void 0:c.body)!==void 0?c.body:{...l,...t.body,id:t.chatId,messages:t.messages,trigger:t.trigger,messageId:t.messageId},z=null!=(o=null==c?void 0:c.credentials)?o:d,v=null!=(i=this.fetch)?i:globalThis.fetch,y=await v(m,{method:"POST",headers:(0,s.WZ)({"Content-Type":"application/json",...h},`ai-sdk/${b}`,(0,s.G1)()),body:JSON.stringify(g),credentials:z,signal:e});if(!y.ok)throw Error(null!=(n=await y.text())?n:"Failed to fetch the chat response.");if(!y.body)throw Error("The response body is empty.");return this.processResponseStream(y.body)}async reconnectToStream(e){var t,a,r,o,i;let n=await (0,s.hd)(this.body),l=await (0,s.hd)(this.headers),p=await (0,s.hd)(this.credentials),d={...(0,s.qx)(l),...(0,s.qx)(e.headers)},u=await (null==(t=this.prepareReconnectToStreamRequest)?void 0:t.call(this,{api:this.api,id:e.chatId,body:{...n,...e.body},headers:d,credentials:p,requestMetadata:e.metadata})),c=null!=(a=null==u?void 0:u.api)?a:`${this.api}/${e.chatId}/stream`,m=(null==u?void 0:u.headers)!==void 0?(0,s.qx)(u.headers):d,h=null!=(r=null==u?void 0:u.credentials)?r:p,g=null!=(o=this.fetch)?o:globalThis.fetch,z=await g(c,{method:"GET",headers:(0,s.WZ)(m,`ai-sdk/${b}`,(0,s.G1)()),credentials:h});if(204===z.status)return null;if(!z.ok)throw Error(null!=(i=await z.text())?i:"Failed to fetch the chat response.");if(!z.body)throw Error("The response body is empty.");return this.processResponseStream(z.body)}},H=class extends Q{constructor(e={}){super(e)}processResponseStream(e){return(0,s._Z)({stream:e,schema:J}).pipeThrough(new TransformStream({async transform(e,t){if(!e.success)throw e.error;t.enqueue(e.value)}}))}},X=class{constructor({generateId:e=s.$C,id:t=e(),transport:a=new H,messageMetadataSchema:r,dataPartSchemas:o,state:i,onError:n,onToolCall:l,onFinish:p,onData:d,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new K,this.sendMessage=async(e,t)=>{var a,r,o,s;let i;if(null==e)return void await this.makeRequest({trigger:"submit-message",messageId:null==(a=this.lastMessage)?void 0:a.id,...t});if(i="text"in e||"files"in e?{parts:[...Array.isArray(e.files)?e.files:await Z(e.files),..."text"in e&&null!=e.text?[{type:"text",text:e.text}]:[]]}:e,null!=e.messageId){let t=this.state.messages.findIndex(t=>t.id===e.messageId);if(-1===t)throw Error(`message with id ${e.messageId} not found`);if("user"!==this.state.messages[t].role)throw Error(`message with id ${e.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,t+1),this.state.replaceMessage(t,{...i,id:e.messageId,role:null!=(r=i.role)?r:"user",metadata:e.metadata})}else this.state.pushMessage({...i,id:null!=(o=i.id)?o:this.generateId(),role:null!=(s=i.role)?s:"user",metadata:e.metadata});await this.makeRequest({trigger:"submit-message",messageId:e.messageId,...t})},this.regenerate=async({messageId:e,...t}={})=>{let a=null==e?this.state.messages.length-1:this.state.messages.findIndex(t=>t.id===e);if(-1===a)throw Error(`message ${e} not found`);this.state.messages=this.state.messages.slice(0,"assistant"===this.messages[a].role?a:a+1),await this.makeRequest({trigger:"regenerate-message",messageId:e,...t})},this.resumeStream=async(e={})=>{await this.makeRequest({trigger:"resume-stream",...e})},this.clearError=()=>{"error"===this.status&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolApprovalResponse=async({id:e,approved:t,reason:a})=>this.jobExecutor.run(async()=>{let r=this.state.messages,o=r[r.length-1],s=r=>$(r)&&"approval-requested"===r.state&&r.approval.id===e?{...r,state:"approval-responded",approval:{id:e,approved:t,reason:a}}:r;this.state.replaceMessage(r.length-1,{...o,parts:o.parts.map(s)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(s)),"streaming"!==this.status&&"submitted"!==this.status&&this.sendAutomaticallyWhen&&this.shouldSendAutomatically().then(e=>{var t;e&&this.makeRequest({trigger:"submit-message",messageId:null==(t=this.lastMessage)?void 0:t.id})})}),this.addToolOutput=async({state:e="output-available",tool:t,toolCallId:a,output:r,errorText:o})=>this.jobExecutor.run(async()=>{let t=this.state.messages,s=t[t.length-1],i=t=>$(t)&&t.toolCallId===a?{...t,state:e,output:r,errorText:o}:t;this.state.replaceMessage(t.length-1,{...s,parts:s.parts.map(i)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(i)),"streaming"!==this.status&&"submitted"!==this.status&&this.sendAutomaticallyWhen&&this.shouldSendAutomatically().then(e=>{var t;e&&this.makeRequest({trigger:"submit-message",messageId:null==(t=this.lastMessage)?void 0:t.id})})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var e;("streaming"===this.status||"submitted"===this.status)&&(null==(e=this.activeResponse)?void 0:e.abortController)&&this.activeResponse.abortController.abort()},this.id=t,this.transport=a,this.generateId=e,this.messageMetadataSchema=r,this.dataPartSchemas=o,this.state=i,this.onError=n,this.onToolCall=l,this.onFinish=p,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:e,error:t}){this.status!==e&&(this.state.status=e,this.state.error=t)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(e){this.state.messages=e}async shouldSendAutomatically(){if(!this.sendAutomaticallyWhen)return!1;let e=this.sendAutomaticallyWhen({messages:this.state.messages});return e&&"object"==typeof e&&"then"in e?await e:e}async makeRequest({trigger:e,metadata:t,headers:a,body:r,messageId:o}){var i,n,l;this.setStatus({status:"submitted",error:void 0});let p=this.lastMessage,d=!1,u=!1,c=!1;try{let i,n={state:function({lastMessage:e,messageId:t}){return{message:(null==e?void 0:e.role)==="assistant"?e:{id:t,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}({lastMessage:this.state.snapshot(p),messageId:this.generateId()}),abortController:new AbortController};if(n.abortController.signal.addEventListener("abort",()=>{d=!0}),this.activeResponse=n,"resume-stream"===e){let e=await this.transport.reconnectToStream({chatId:this.id,metadata:t,headers:a,body:r});if(null==e)return void this.setStatus({status:"ready"});i=e}else i=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:n.abortController.signal,metadata:t,headers:a,body:r,trigger:e,messageId:o});let l=e=>this.jobExecutor.run(()=>e({state:n.state,write:()=>{var e;this.setStatus({status:"streaming"}),n.state.message.id===(null==(e=this.lastMessage)?void 0:e.id)?this.state.replaceMessage(this.state.messages.length-1,n.state.message):this.state.pushMessage(n.state.message)}}));await G({stream:function({stream:e,messageMetadataSchema:t,dataPartSchemas:a,runUpdateMessageJob:r,onError:o,onToolCall:i,onData:n}){return e.pipeThrough(new TransformStream({async transform(e,l){await r(async({state:r,write:p})=>{var d,u,c,m;function h(e){let t=r.message.parts.filter($).find(t=>t.toolCallId===e);if(null==t)throw new v({chunkType:"tool-invocation",chunkId:e,message:`No tool invocation found for tool call ID "${e}".`});return t}function g(e){var t;let a=r.message.parts.find(t=>Y(t)&&t.toolCallId===e.toolCallId);null!=a?(a.state=e.state,a.input=e.input,a.output=e.output,a.errorText=e.errorText,a.rawInput=e.rawInput,a.preliminary=e.preliminary,void 0!==e.title&&(a.title=e.title),a.providerExecuted=null!=(t=e.providerExecuted)?t:a.providerExecuted,null!=e.providerMetadata&&(a.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:`tool-${e.toolName}`,toolCallId:e.toolCallId,state:e.state,title:e.title,input:e.input,output:e.output,rawInput:e.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,preliminary:e.preliminary,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}function z(e){var t,a;let o=r.message.parts.find(t=>"dynamic-tool"===t.type&&t.toolCallId===e.toolCallId);null!=o?(o.state=e.state,o.toolName=e.toolName,o.input=e.input,o.output=e.output,o.errorText=e.errorText,o.rawInput=null!=(t=e.rawInput)?t:o.rawInput,o.preliminary=e.preliminary,void 0!==e.title&&(o.title=e.title),o.providerExecuted=null!=(a=e.providerExecuted)?a:o.providerExecuted,null!=e.providerMetadata&&(o.callProviderMetadata=e.providerMetadata)):r.message.parts.push({type:"dynamic-tool",toolName:e.toolName,toolCallId:e.toolCallId,state:e.state,input:e.input,output:e.output,errorText:e.errorText,preliminary:e.preliminary,providerExecuted:e.providerExecuted,title:e.title,...null!=e.providerMetadata?{callProviderMetadata:e.providerMetadata}:{}})}async function b(e){if(null!=e){let a=null!=r.message.metadata?function e(t,a){if(void 0===t&&void 0===a)return;if(void 0===t)return a;if(void 0===a)return t;let r={...t};for(let o in a)if(Object.prototype.hasOwnProperty.call(a,o)){let s=a[o];if(void 0===s)continue;let i=o in t?t[o]:void 0,n=null!==s&&"object"==typeof s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),l=null!=i&&"object"==typeof i&&!Array.isArray(i)&&!(i instanceof Date)&&!(i instanceof RegExp);n&&l?r[o]=e(i,s):r[o]=s}return r}(r.message.metadata,e):e;null!=t&&await (0,s.k5)({value:a,schema:t,context:{field:"message.metadata",entityId:r.message.id}}),r.message.metadata=a}}switch(e.type){case"text-start":{let t={type:"text",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeTextParts[e.id]=t,r.message.parts.push(t),p();break}case"text-delta":{let t=r.activeTextParts[e.id];if(null==t)throw new v({chunkType:"text-delta",chunkId:e.id,message:`Received text-delta for missing text part with ID "${e.id}". Ensure a "text-start" chunk is sent before any "text-delta" chunks.`});t.text+=e.delta,t.providerMetadata=null!=(d=e.providerMetadata)?d:t.providerMetadata,p();break}case"text-end":{let t=r.activeTextParts[e.id];if(null==t)throw new v({chunkType:"text-end",chunkId:e.id,message:`Received text-end for missing text part with ID "${e.id}". Ensure a "text-start" chunk is sent before any "text-end" chunks.`});t.state="done",t.providerMetadata=null!=(u=e.providerMetadata)?u:t.providerMetadata,delete r.activeTextParts[e.id],p();break}case"reasoning-start":{let t={type:"reasoning",text:"",providerMetadata:e.providerMetadata,state:"streaming"};r.activeReasoningParts[e.id]=t,r.message.parts.push(t),p();break}case"reasoning-delta":{let t=r.activeReasoningParts[e.id];if(null==t)throw new v({chunkType:"reasoning-delta",chunkId:e.id,message:`Received reasoning-delta for missing reasoning part with ID "${e.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-delta" chunks.`});t.text+=e.delta,t.providerMetadata=null!=(c=e.providerMetadata)?c:t.providerMetadata,p();break}case"reasoning-end":{let t=r.activeReasoningParts[e.id];if(null==t)throw new v({chunkType:"reasoning-end",chunkId:e.id,message:`Received reasoning-end for missing reasoning part with ID "${e.id}". Ensure a "reasoning-start" chunk is sent before any "reasoning-end" chunks.`});t.providerMetadata=null!=(m=e.providerMetadata)?m:t.providerMetadata,t.state="done",delete r.activeReasoningParts[e.id],p();break}case"file":r.message.parts.push({type:"file",mediaType:e.mediaType,url:e.url}),p();break;case"source-url":r.message.parts.push({type:"source-url",sourceId:e.sourceId,url:e.url,title:e.title,providerMetadata:e.providerMetadata}),p();break;case"source-document":r.message.parts.push({type:"source-document",sourceId:e.sourceId,mediaType:e.mediaType,title:e.title,filename:e.filename,providerMetadata:e.providerMetadata}),p();break;case"tool-input-start":{let t=r.message.parts.filter(Y);r.partialToolCalls[e.toolCallId]={text:"",toolName:e.toolName,index:t.length,dynamic:e.dynamic,title:e.title},e.dynamic?z({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted,title:e.title,providerMetadata:e.providerMetadata}):g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-streaming",input:void 0,providerExecuted:e.providerExecuted,title:e.title,providerMetadata:e.providerMetadata}),p();break}case"tool-input-delta":{let t=r.partialToolCalls[e.toolCallId];if(null==t)throw new v({chunkType:"tool-input-delta",chunkId:e.toolCallId,message:`Received tool-input-delta for missing tool call with ID "${e.toolCallId}". Ensure a "tool-input-start" chunk is sent before any "tool-input-delta" chunks.`});t.text+=e.inputTextDelta;let{value:a}=await F(t.text);t.dynamic?z({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a,title:t.title}):g({toolCallId:e.toolCallId,toolName:t.toolName,state:"input-streaming",input:a,title:t.title}),p();break}case"tool-input-available":e.dynamic?z({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}):g({toolCallId:e.toolCallId,toolName:e.toolName,state:"input-available",input:e.input,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata,title:e.title}),p(),i&&!e.providerExecuted&&await i({toolCall:e});break;case"tool-input-error":e.dynamic?z({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}):g({toolCallId:e.toolCallId,toolName:e.toolName,state:"output-error",input:void 0,rawInput:e.input,errorText:e.errorText,providerExecuted:e.providerExecuted,providerMetadata:e.providerMetadata}),p();break;case"tool-approval-request":{let t=h(e.toolCallId);t.state="approval-requested",t.approval={id:e.approvalId},p();break}case"tool-output-denied":h(e.toolCallId).state="output-denied",p();break;case"tool-output-available":{let t=h(e.toolCallId);"dynamic-tool"===t.type?z({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-available",input:t.input,output:e.output,preliminary:e.preliminary,providerExecuted:e.providerExecuted,title:t.title}):g({toolCallId:e.toolCallId,toolName:V(t),state:"output-available",input:t.input,output:e.output,providerExecuted:e.providerExecuted,preliminary:e.preliminary,title:t.title}),p();break}case"tool-output-error":{let t=h(e.toolCallId);"dynamic-tool"===t.type?z({toolCallId:e.toolCallId,toolName:t.toolName,state:"output-error",input:t.input,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}):g({toolCallId:e.toolCallId,toolName:V(t),state:"output-error",input:t.input,rawInput:t.rawInput,errorText:e.errorText,providerExecuted:e.providerExecuted,title:t.title}),p();break}case"start-step":r.message.parts.push({type:"step-start"});break;case"finish-step":r.activeTextParts={},r.activeReasoningParts={};break;case"start":null!=e.messageId&&(r.message.id=e.messageId),await b(e.messageMetadata),(null!=e.messageId||null!=e.messageMetadata)&&p();break;case"finish":null!=e.finishReason&&(r.finishReason=e.finishReason),await b(e.messageMetadata),null!=e.messageMetadata&&p();break;case"message-metadata":await b(e.messageMetadata),null!=e.messageMetadata&&p();break;case"error":null==o||o(Error(e.errorText));break;default:if(e.type.startsWith("data-")){if((null==a?void 0:a[e.type])!=null){let t=r.message.parts.findIndex(t=>"id"in t&&"data"in t&&t.id===e.id&&t.type===e.type),o=t>=0?t:r.message.parts.length;await (0,s.k5)({value:e.data,schema:a[e.type],context:{field:`message.parts[${o}].data`,entityName:e.type,entityId:e.id}})}if(e.transient){null==n||n(e);break}let t=null!=e.id?r.message.parts.find(t=>e.type===t.type&&e.id===t.id):void 0;null!=t?t.data=e.data:r.message.parts.push(e),null==n||n(e),p()}}l.enqueue(e)})}}))}({stream:i,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:l,onError:e=>{throw e}}),onError:e=>{throw e}}),this.setStatus({status:"ready"})}catch(e){if(d||"AbortError"===e.name)return d=!0,this.setStatus({status:"ready"}),null;c=!0,e instanceof TypeError&&(e.message.toLowerCase().includes("fetch")||e.message.toLowerCase().includes("network"))&&(u=!0),this.onError&&e instanceof Error&&this.onError(e),this.setStatus({status:"error",error:e})}finally{try{null==(n=this.onFinish)||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:d,isDisconnect:u,isError:c,finishReason:null==(i=this.activeResponse)?void 0:i.state.finishReason})}catch(e){console.error(e)}this.activeResponse=void 0}!c&&await this.shouldSendAutomatically()&&await this.makeRequest({trigger:"submit-message",messageId:null==(l=this.lastMessage)?void 0:l.id,metadata:t,headers:a,body:r})}}}}]);