"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[42697],{42697:(e,t,i)=>{i.d(t,{A:()=>d,_:()=>v,a:()=>T,b:()=>h,i:()=>I,k:()=>f,n:()=>E,t:()=>A});var n=i(99019),s=i(5147),r=i(15457),o=i(14796),l=i(48674),a=i(81993),g=i(50357),u=i(78568);let d=(e,t)=>{if(o.Qg.isText(t)||o.$7.isElement(t)&&e.api.isInline(t)){var i;return o.$7.isElement(t)?o.lZ.string(t):t[l.t.suggestion]&&(null==(i=e.getApi(T).suggestion.suggestionData(t))?void 0:i.type)==="remove"?"":t.text}return t.children.map(t=>d(e,t)).join("")},c=e=>Object.keys(e).filter(e=>e.startsWith("".concat(l.t.suggestion,"_"))).at(-1),p=e=>{let t=c(e);if(t)return e[t]},f=e=>e.replace("".concat(l.t.suggestion,"_"),""),h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"0";return"".concat(l.t.suggestion,"_").concat(e)},m=(e,t)=>{var i;let{currentUserId:n}=e.getOptions(T);return(null==(i=p(t))?void 0:i.userId)===n},v=()=>"".concat(l.t.suggestion,"Transient"),x=(e,t)=>{var i,n,s,r,o,l,g;let{at:u,type:d}=t,c={id:(0,a.Ak)(),createdAt:Date.now()},f=e.getApi(T),h=f.suggestion.node({at:u,isText:!0});if(!h){let t,i;try{[t,i]=e.api.edges(u)}catch(e){return c}let n=e.api.after(i);if(n&&!(h=f.suggestion.node({at:n,isText:!0}))){let i=e.api.before(t);if(i&&(h=f.suggestion.node({at:i,isText:!0})),!h&&e.api.isStart(t,u)){let t=null==(g=e.api.above({at:null!=i?i:u}))?void 0:g[0].suggestion;if(null==t?void 0:t.isLineBreak)return{id:null!=(o=null==t?void 0:t.id)?o:(0,a.Ak)(),createdAt:null!=(l=null==t?void 0:t.createdAt)?l:Date.now()}}}}return h&&(null==(s=p(h[0]))?void 0:s.type)===d&&m(e,h[0])?{id:null!=(i=f.suggestion.nodeId(h[0]))?i:(0,a.Ak)(),createdAt:null!=(n=null==(r=p(h[0]))?void 0:r.createdAt)?n:Date.now()}:c},y=(e,t)=>{var i;let s=null!=(i=(0,o.sM)(e,null==t?void 0:t.at))?i:e.selection;if(!s)return;let{suggestionId:r=(0,a.Ak)()}=null!=t?t:{},g=[...e.api.nodes((0,n._)({match:t=>o.$7.isElement(t)&&e.api.isInline(t)},t))];e.tf.withoutNormalizing(()=>{var i;let a={id:r,createdAt:null!=(i=null==t?void 0:t.createdAt)?i:Date.now(),type:"remove",userId:e.getOptions(T).currentUserId},u={[h(r)]:a,[l.t.suggestion]:!0};e.tf.setNodes(u,{at:s,marks:!0}),g.forEach(i=>{let[,s]=i;e.tf.setNodes(u,(0,n._)({at:s,match:t=>o.$7.isElement(t)&&e.api.isInline(t)},t))})})},k=function(e,t){let i,{reverse:n}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return e.tf.withoutNormalizing(()=>{let s,{anchor:r,focus:a}=t,{id:g,createdAt:u}=x(e,{at:r,type:"remove"});i=g;let d=e.api.pointRef(a);for(;;){var c;if(!(s=null==(c=e.selection)?void 0:c.anchor))break;let t=d.current;if(!t||!e.api.isAt({at:{anchor:s,focus:t},blocks:!0})&&0===e.api.string(n?{anchor:t,focus:s}:{anchor:s,focus:t}).length)break;let i=(n?e.api.before:e.api.after)(s,{unit:"character"});if(!i)break;let r=n?{anchor:i,focus:s}:{anchor:s,focus:i};r=e.api.unhangRange(r,{character:!0});let a=e.api.node({at:s,block:!0,match:t=>{var i;return t[l.t.suggestion]&&o.Qg.isText(t)&&(null==(i=p(t))?void 0:i.type)==="insert"&&m(e,t)}});if(a&&e.api.isStart(s,a[1])&&e.api.isEmpty(a[0])){e.tf.removeNodes({at:a[1]});continue}if(e.api.isAt({at:r,blocks:!0})){let t=e.api.above({at:r.anchor});if(t&&o.$7.isElement(t[0])){let i=e.getApi(T).suggestion.isBlockSuggestion(t[0]);if(i){let i=t[0];"insert"===i.suggestion.type&&e.getApi(T).suggestion.withoutSuggestions(()=>{e.tf.unsetNodes([l.t.suggestion],{at:t[1]}),e.tf.mergeNodes({at:o.s2.next(t[1])})}),"remove"===i.suggestion.type&&e.tf.move({reverse:n,unit:"character"});break}i||(e.tf.setNodes({[l.t.suggestion]:{id:g,createdAt:u,type:"remove",userId:e.getOptions(T).currentUserId}},{at:t[1]}),e.tf.move({reverse:n,unit:"character"}))}break}if(o.LQ.equals(s,e.selection.anchor)&&e.tf.move({reverse:n,unit:"character"}),e.getApi(T).suggestion.node({at:r,isText:!0,match:t=>{var i;return o.Qg.isText(t)&&(null==(i=p(t))?void 0:i.type)==="insert"&&m(e,t)}})){e.tf.delete({at:r,unit:"character"});continue}y(e,{at:r,createdAt:u,suggestionDeletion:!0,suggestionId:g})}}),i},_=function(e){let t,{reverse:i}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.tf.withoutNormalizing(()=>{let n=e.selection,[s,r]=e.api.edges(n);i?(e.tf.collapse({edge:"end"}),t=k(e,{anchor:r,focus:s},{reverse:!0})):(e.tf.collapse({edge:"start"}),t=k(e,{anchor:s,focus:r}))}),t},b=function(e,t){let{insertFragment:i=e.tf.insertFragment}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e.tf.withoutNormalizing(()=>{_(e);let{id:n,createdAt:s}=x(e,{at:e.selection,type:"insert"});t.forEach(t=>{if(o.Qg.isText(t)){let i;t[l.t.suggestion]||(t[l.t.suggestion]=!0),(i=[],Object.keys(t).forEach(e=>{e.startsWith("".concat(l.t.suggestion,"_"))&&i.push(e)}),i).forEach(e=>{delete t[e]}),t[h(n)]={id:n,createdAt:s,type:"insert",userId:e.getOptions(T).currentUserId}}else t[l.t.suggestion]={id:n,createdAt:s,type:"insert",userId:e.getOptions(T).currentUserId}}),e.getApi(T).suggestion.withoutSuggestions(()=>{i(t)})})},N=(e,t)=>{e.tf.withoutNormalizing(()=>{let i,{id:n,createdAt:s}=x(e,{at:e.selection,type:"insert"});e.api.isExpanded()&&(i=_(e)),e.getApi(T).suggestion.withoutSuggestions(()=>{e.tf.insertNodes({[h(null!=i?i:n)]:{id:null!=i?i:n,createdAt:s,type:"insert",userId:e.getOptions(T).currentUserId},suggestion:!0,text:t},{at:e.selection,select:!0})})})},T=(0,g.qt)({key:l.t.suggestion,node:{isLeaf:!0},options:{currentUserId:"alice",isSuggesting:!1},rules:{selection:{affinity:"outward"}}}).overrideEditor(e=>{let{api:t,editor:i,getOptions:r,tf:{addMark:g,apply:u,deleteBackward:d,deleteForward:f,deleteFragment:m,insertBreak:v,insertFragment:y,insertNodes:I,insertText:w,normalizeNode:E,removeMark:A,removeNodes:S}}=e;return{transforms:{addMark(e,n){if(r().isSuggesting&&t.isExpanded())return void i.getApi(T).suggestion.withoutSuggestions(()=>{let{id:t,createdAt:s}={id:(0,a.Ak)(),createdAt:Date.now()};i.tf.setNodes({[e]:n,[h(t)]:{id:t,createdAt:s,newProperties:{[e]:n},type:"update",userId:i.getOptions(T).currentUserId},[l.t.suggestion]:!0},{match:e=>{if(!o.Qg.isText(e))return!1;if(e[l.t.suggestion]){var t;return(null==(t=p(e))?void 0:t.type)==="update"}return!0},split:!0})});return g(e,n)},apply:e=>u(e),deleteBackward(e){let t=i.selection,n=i.api.before(t,{unit:e});if(r().isSuggesting){let s=i.api.above();return(null==s?void 0:s[0][l.t.suggestion])&&!(null==s?void 0:s[0].suggestion.isLineBreak)?d(e):void(n&&k(i,{anchor:t.anchor,focus:n},{reverse:!0}))}n&&i.api.isAt({at:{anchor:t.anchor,focus:n},blocks:!0})&&i.tf.unsetNodes([l.t.suggestion],{at:n}),d(e)},deleteForward(e){if(r().isSuggesting){let t=i.selection,n=i.api.after(t,{unit:e});if(!n)return;k(i,{anchor:t.anchor,focus:n});return}f(e)},deleteFragment(e){r().isSuggesting?_(i,{reverse:!0}):m(e)},insertBreak(){if(r().isSuggesting){let[e,t]=i.api.above();if(t.length>1||e.type!==i.getType(l.t.p))return N(i,"\n");let{id:n,createdAt:s}=x(i,{at:i.selection,type:"insert"});return v(),void i.tf.withoutMerging(()=>{i.tf.setNodes({[l.t.suggestion]:{id:n,createdAt:s,isLineBreak:!0,type:"insert",userId:i.getOptions(T).currentUserId}},{at:t})})}v()},insertFragment(e){r().isSuggesting?b(i,e,{insertFragment:y}):y(e)},insertNodes(e,o){if(r().isSuggesting){let r=Array.isArray(e)?e:[e];return r.some(e=>"slash_input"===e.type)?void t.suggestion.withoutSuggestions(()=>{I(e,o)}):I(r.map(e=>(0,s._)((0,n._)({},e),{[l.t.suggestion]:{id:(0,a.Ak)(),createdAt:Date.now(),type:"insert",userId:i.getOptions(T).currentUserId}})),o)}return I(e,o)},insertText(e,t){if(r().isSuggesting){let n=i.api.above();return(null==n?void 0:n[0][l.t.suggestion])&&!(null==n?void 0:n[0].suggestion.isLineBreak)?w(e,t):void N(i,e)}w(e,t)},normalizeNode(e){t.suggestion.withoutSuggestions(()=>{var t,n;let[s,r]=e,a=o.$7.isElement(s)&&i.api.isInline(s)||o.Qg.isText(s);s[l.t.suggestion]&&a&&!c(s)?i.tf.unsetNodes([l.t.suggestion,"suggestionData"],{at:r}):s[l.t.suggestion]&&a&&!(null==(t=p(s))?void 0:t.userId)?(null==(n=p(s))?void 0:n.type)==="remove"?i.tf.unsetNodes([l.t.suggestion,c(s)],{at:r}):i.tf.removeNodes({at:r}):E(e)})},removeMark(e){if(r().isSuggesting&&t.isExpanded())return void i.getApi(T).suggestion.withoutSuggestions(()=>{let{id:t,createdAt:n}={id:(0,a.Ak)(),createdAt:Date.now()},s=e=>{if(!o.Qg.isText(e))return!1;if(e[l.t.suggestion]){var t;return(null==(t=p(e))?void 0:t.type)==="update"}return!0};i.tf.unsetNodes(e,{match:s}),i.tf.setNodes({[h(t)]:{id:t,createdAt:n,properties:{[e]:void 0},type:"update",userId:i.getOptions(T).currentUserId},[l.t.suggestion]:!0},{match:s})});return A(e)},removeNodes(e){if(r().isSuggesting){let n=[...i.api.nodes(e)];return n.some(e=>{let[t]=e;return"slash_input"===t.type})?void t.suggestion.withoutSuggestions(()=>{S(e)}):((e,t)=>{if(0===t.length)return;let{id:i,createdAt:n}=x(e,{at:e.selection,type:"remove"});t.forEach(t=>{let[,s]=t;e.tf.setNodes({[l.t.suggestion]:{id:i,createdAt:n,type:"remove"}},{at:s})})})(i,n)}return S(e)}}}}).extendApi(e=>{let{api:t,editor:i,getOption:a,setOption:g,type:u}=e;return{dataList:e=>Object.keys(e).filter(e=>e.startsWith("".concat(l.t.suggestion,"_"))).map(t=>e[t]),isBlockSuggestion:e=>o.$7.isElement(e)&&!i.api.isInline(e)&&"suggestion"in e,node:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{id:s,isText:l}=e,a=(0,r._)(e,["id","isText"]);return i.api.node((0,n._)({match:e=>{if(!e[u]||l&&!o.Qg.isText(e))return!1;if(s){if(o.Qg.isText(e))return!!e[h(s)];if(o.$7.isElement(e)&&t.suggestion.isBlockSuggestion(e))return e.suggestion.id===s}return!0}},a))},nodeId:e=>{if(o.Qg.isText(e)||o.$7.isElement(e)&&i.api.isInline(e)){let t=c(e);if(!t)return;return t.replace("".concat(u,"_"),"")}if(t.suggestion.isBlockSuggestion(e))return e.suggestion.id},nodes:function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{transient:r}=t,l=null!=(e=(0,o.sM)(i,t.at))?e:[];return[...i.api.nodes((0,s._)((0,n._)({},t),{at:l,mode:"all",match:e=>e[u]&&(!r||e[v()])}))]},suggestionData:e=>{if(o.Qg.isText(e)||o.$7.isElement(e)&&i.api.isInline(e)){let t=c(e);if(!t)return;return e[t]}if(t.suggestion.isBlockSuggestion(e))return e.suggestion},withoutSuggestions:e=>{let t=a("isSuggesting");g("isSuggesting",!1),e(),g("isSuggesting",t)}}}),I=(e,t)=>{e.tf.withoutNormalizing(()=>{[...e.api.nodes({at:[],match:i=>!!o.$7.isElement(i)&&!!e.getApi(T).suggestion.isBlockSuggestion(i)&&"remove"===i.suggestion.type&&i.suggestion.isLineBreak&&i.suggestion.id===t.suggestionId})].reverse().forEach(t=>{let[,i]=t;e.tf.mergeNodes({at:o.s2.next(i)})}),e.tf.unsetNodes([t.keyId,l.t.suggestion,v()],{at:[],mode:"all",match:i=>{if(o.Qg.isText(i)||o.$7.isElement(i)&&e.api.isInline(i)){let n=e.getApi(T).suggestion.dataList(i);if(n.some(e=>"update"===e.type))return n.some(e=>e.id===t.suggestionId);let s=p(i);return!!s&&"insert"===s.type&&s.id===t.suggestionId}if(o.$7.isElement(i)&&e.getApi(T).suggestion.isBlockSuggestion(i)){let e=i.suggestion;if(e)return e.isLineBreak?e.id===t.suggestionId:"insert"===e.type&&e.id===t.suggestionId}return!1}}),e.tf.removeNodes({at:[],mode:"all",match:i=>{if(o.Qg.isText(i)||o.$7.isElement(i)&&e.api.isInline(i)){let e=p(i);return!!e&&"remove"===e.type&&e.id===t.suggestionId}if(o.$7.isElement(i)&&e.getApi(T).suggestion.isBlockSuggestion(i)){let e=i.suggestion;if(e){let i=e.isLineBreak;return"remove"===e.type&&e.id===t.suggestionId&&!i}}return!1}})})},w=function(e,t){let{id:i=(0,a.Ak)(),createdAt:n=Date.now(),suggestionDeletion:s,suggestionUpdate:r,transient:g}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=o.$7.isElement(t),d={id:i,createdAt:n,type:s?"remove":r?"update":"insert",userId:e.getOptions(T).currentUserId};if(u)return{[l.t.suggestion]:d};let c={[h(i)]:d,[l.t.suggestion]:!0};return g&&(c[v()]=!0),c},E=(e,t)=>{e.tf.withoutNormalizing(()=>{[...e.api.nodes({at:[],match:i=>!!o.$7.isElement(i)&&!!e.getApi(T).suggestion.isBlockSuggestion(i)&&"insert"===i.suggestion.type&&i.suggestion.isLineBreak&&i.suggestion.id===t.suggestionId})].reverse().forEach(t=>{let[,i]=t;e.tf.mergeNodes({at:o.s2.next(i)})}),e.tf.unsetNodes([t.keyId,l.t.suggestion,v()],{at:[],mode:"all",match:i=>{if(o.Qg.isText(i)){let e=p(i);return!!e&&"remove"===e.type&&e.id===t.suggestionId}return!!(o.$7.isElement(i)&&e.getApi(T).suggestion.isBlockSuggestion(i))&&(i.suggestion.isLineBreak?i.suggestion.id===t.suggestionId:"remove"===i.suggestion.type&&i.suggestion.id===t.suggestionId)}}),e.tf.removeNodes({at:[],mode:"all",match:i=>{if(o.Qg.isText(i)){let e=p(i);return!!e&&"insert"===e.type&&e.id===t.suggestionId}return!!(o.$7.isElement(i)&&e.getApi(T).suggestion.isBlockSuggestion(i))&&"insert"===i.suggestion.type&&i.suggestion.id===t.suggestionId&&!i.suggestion.isLineBreak}}),[...e.api.nodes({at:[],match:i=>{if(o.$7.isElement(i))return!1;if(o.Qg.isText(i)){let n=e.getApi(T).suggestion.dataList(i);return n.length>0&&n.some(e=>"update"===e.type&&e.id===t.suggestionId)}}})].forEach(i=>{let[n,s]=i,r=e.getApi(T).suggestion.dataList(n).find(e=>"update"===e.type&&e.id===t.suggestionId);if(r){if("newProperties"in r){let t=Object.keys(r.newProperties).filter(e=>r.newProperties[e]);e.tf.unsetNodes([...t],{at:s})}if("properties"in r){let t=Object.keys(r.properties).filter(e=>!r.properties[e]);e.tf.setNodes(Object.fromEntries(t.map(e=>[e,!0])),{at:s})}e.tf.unsetNodes([h(r.id)],{at:s})}})})};function A(e,t,i){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,[g={}]=[a],{getDeleteProps:d=t=>w(e,t,{suggestionDeletion:!0}),getInsertProps:c=t=>w(e,t),getUpdateProps:p=(t,i,n)=>w(e,t,{suggestionUpdate:n}),isInline:f=e.api.isInline}=g,m=(0,r._)(g,["getDeleteProps","getInsertProps","getUpdateProps","isInline"]),v=(0,u.xs)(t,i,(0,n._)({getDeleteProps:d,getInsertProps:c,getUpdateProps:p,isInline:f},m)),x=t=>t.map((i,r)=>o.$7.isElement(i)&&"children"in i?(0,s._)((0,n._)({},i),{children:x(i.children)}):o.Qg.isText(i)&&i[l.t.suggestion]?function(e,t,i,r){let o=r.getApi(T),a=o.suggestion.suggestionData(e);if((null==a?void 0:a.type)==="insert"){let r=t>0?i[t-1]:null;if(null==r?void 0:r[l.t.suggestion]){let t=o.suggestion.suggestionData(r);if((null==t?void 0:t.type)==="remove"){let i=(0,s._)((0,n._)({},e),{[h(t.id)]:(0,s._)((0,n._)({},a),{id:t.id,createdAt:t.createdAt})}),r=h(a.id);return delete i[r],i}}}return e}(i,r,t,e):i);return x(v)}},48674:(e,t,i)=>{i.d(t,{t:()=>s});var n=i(99019);let s=(0,i(5147)._)((0,n._)({},{a:"a",ai:"ai",aiChat:"aiChat",audio:"audio",blockquote:"blockquote",bold:"bold",callout:"callout",code:"code",codeBlock:"code_block",codeLine:"code_line",codeSyntax:"code_syntax",column:"column",columnGroup:"column_group",comment:"comment",date:"date",emojiInput:"emoji_input",equation:"equation",excalidraw:"excalidraw",file:"file",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",highlight:"highlight",hr:"hr",img:"img",inlineEquation:"inline_equation",italic:"italic",kbd:"kbd",li:"li",lic:"lic",link:"a",listTodoClassic:"action_item",mediaEmbed:"media_embed",mention:"mention",mentionInput:"mention_input",olClassic:"ol",p:"p",searchHighlight:"search_highlight",slashInput:"slash_input",strikethrough:"strikethrough",sub:"subscript",suggestion:"suggestion",sup:"superscript",table:"table",tag:"tag",taskList:"taskList",td:"td",th:"th",toc:"toc",toggle:"toggle",tr:"tr",ulClassic:"ul",underline:"underline",video:"video"},{backgroundColor:"backgroundColor",color:"color",fontFamily:"fontFamily",fontSize:"fontSize",fontWeight:"fontWeight",indent:"indent",lineHeight:"lineHeight",listType:"listStyleType",textAlign:"textAlign",textIndent:"textIndent"}),{autoformat:"autoformat",blockMenu:"blockMenu",blockPlaceholder:"blockPlaceholder",blockSelection:"blockSelection",caption:"caption",copilot:"copilot",csv:"csv",cursorOverlay:"cursorOverlay",delete:"delete",dnd:"dnd",docx:"docx",emoji:"emoji",exitBreak:"exitBreak",heading:["h1","h2","h3","h4","h5","h6"],html:"html",juice:"juice",list:"list",listChecked:"checked",listClassic:"listClassic",listRestart:"listRestart",listRestartPolite:"listRestartPolite",listStart:"listStart",listTodo:"todo",markdown:"markdown",nodeId:"nodeId",normalizeTypes:"normalizeTypes",ol:"decimal",placeholder:"placeholder",playwright:"playwright",removeEmptyNodes:"removeEmptyNodes",resetNode:"resetNode",singleBlock:"singleBlock",singleLine:"singleLine",slashCommand:"slash_command",softBreak:"softBreak",tabbable:"tabbable",trailingBlock:"trailingBlock",ul:"disc",yjs:"yjs",codeDrawing:"code_drawing"})},78568:(e,t,i)=>{i.d(t,{qQ:()=>$,xs:()=>B});var n=i(99019),s=i(5147),r=i(15457),o=i(14796),l=i(48674),a=i(91188),g=i(40331),u=i(63780),d=i(31969),c=i(91579);let p=function(e){let{ignoreDeep:t=[],ignoreShallow:i=[]}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Array.isArray(e))return e.map(e=>p(e,{ignoreDeep:t,ignoreShallow:i}));if(!g(e))return e;let n={};for(let[s,r]of Object.entries(e))i.includes(s)||t.includes(s)||(n[s]=p(r,{ignoreDeep:t}));return n},f=(e,t,i)=>a(p(e,i),p(t,i)),h=[(e,t,i)=>{if(null!=e.children&&null!=t.children&&f(e,t,{ignoreDeep:i.ignoreProps,ignoreShallow:["children"]})){let r=B(e.children,t.children,i);return[(0,s._)((0,n._)({},t),{children:r})]}return!1},(e,t,i)=>{let{getUpdateProps:s}=i,r={},o={};for(let i in e)if(!f(e[i],t[i])){if("children"===i||"text"===i)return!1;r[i]=e[i],o[i]=t[i]}for(let i in t)if(void 0===e[i]){if("children"===i||"text"===i)return!1;o[i]=t[i]}return[(0,n._)({},t,s(e,r,o))]}],m=new u.rY;function v(e,t){let i={};for(let n in e)"text"!==n&&(null==t?e[n]&&(i[n]=e[n]):e[n]!==t[n]&&(e[n]?i[n]=e[n]:i[n]=void 0));if(null!=t)for(let n in t)"text"!==n&&null==e[n]&&(i[n]=void 0);return i}m.Diff_Timeout=.2;var x=class{insertBetweenPairs(e,t){return e.flatMap((i,n)=>n===e.length-1?i:[i,t])}replaceCharWithNode(e,t,i){return e.flatMap(e=>{if(!o.Qg.isText(e))return[e];let r=e.text.split(t);if(1===r.length)return[e];let l=(0,n._)({},i,o.lZ.extractProps(e)),a=r.map(t=>(0,s._)((0,n._)({},e),{text:t}));return this.insertBetweenPairs(a,l).filter(e=>!o.Qg.isText(e)||e.text.length>0)})}nodeToText(e){if(o.Qg.isText(e))return e;let t=this._charGenerator.next().value;return this._charToNode.set(t,e),{text:t}}textToNode(e){let t=[e];for(let[e,i]of this._charToNode)t=this.replaceCharWithNode(t,e,i);return t}constructor({charGenerator:e}){this._charToNode=new Map,this._charGenerator=e}};function*y(){let{skipChars:e=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new Set(e);for(let e=65;;e++){let i=String.fromCodePoint(e);t.has(i)||(yield i)}}let k=(e,t,i)=>{if(!e.recordingOperations)return t(i);S(e,()=>{switch(i.type){case"insert_text":_(e,t,i);break;case"merge_node":N(e,t,i);break;case"remove_text":b(e,t,i);break;case"set_node":I(e,t,i);break;case"split_node":T(e,t,i);break;default:t(i)}})},_=(e,t,i)=>{let r=o.lZ.get(e,i.path);t(i);let l={anchor:{offset:i.offset,path:i.path},focus:{offset:i.offset+i.text.length,path:i.path}},a=e.api.rangeRef(l);e.insertedTexts.push({node:(0,s._)((0,n._)({},r),{text:i.text}),rangeRef:a})},b=(e,t,i)=>{let r=o.lZ.get(e,i.path);t(i);let l={offset:i.offset,path:i.path},a=e.api.pointRef(l,{affinity:"backward"});e.removedTexts.push({node:(0,s._)((0,n._)({},r),{text:i.text}),pointRef:a})},N=(e,t,i)=>{let n=o.lZ.get(e,i.path),s=o.lZ.extractProps(n),r=o.s2.previous(i.path),l=o.lZ.get(e,r),a=o.lZ.extractProps(l);t(i);let g={anchor:{offset:l.text.length,path:r},focus:e.api.end(r)},u=e.api.rangeRef(g);e.propsChanges.push({newProperties:a,properties:s,rangeRef:u})},T=(e,t,i)=>{let n=o.lZ.get(e,i.path),s=o.lZ.extractProps(n),r=i.properties;t(i);let l=o.s2.next(i.path),a=e.api.range(l),g=e.api.rangeRef(a);e.propsChanges.push({newProperties:r,properties:s,rangeRef:g})},I=(e,t,i)=>{t(i);let n=e.api.range(i.path),s=e.api.rangeRef(n);e.propsChanges.push({newProperties:i.newProperties,properties:i.properties,rangeRef:s})},w=(e,t)=>{let{getDeleteProps:i,getInsertProps:s,getUpdateProps:r}=t;S(e,()=>{E(e).reverse().forEach(t=>{let{newProperties:i,properties:n,range:s}=t,l=o.lZ.get(e,s.anchor.path);e.tf.setNodes(r(l,n,i),{at:s,marks:!0})}),e.removedTexts.forEach(t=>{let{node:s,pointRef:r}=t,o=r.current;o&&e.tf.insertNode((0,n._)({},s,i(s)),{at:o}),r.unref()}),e.insertedTexts.forEach(t=>{let{node:i,rangeRef:n}=t,r=n.current;r&&e.tf.setNodes(s(i),{at:r,marks:!0}),n.unref()})})},E=e=>{let t=e.propsChanges.map(e=>{let{rangeRef:t}=e;return t}),i=d([...t,...e.insertedTexts.map(e=>{let{rangeRef:t}=e;return t})].flatMap(e=>{let t=e.current;return t?[t.anchor,t.focus]:[]}).sort(o.LQ.compare),o.LQ.equals);if(i.length<2)return[];let n=Array.from({length:i.length-1}).fill(null).map((e,t)=>({anchor:i[t],focus:i[t+1]})).map(t=>{let i=e=>e.filter(e=>{let{rangeRef:i}=e,n=i.current;if(!n)return!1;let s=o.Cb.intersection(n,t);return!!s&&o.Cb.isExpanded(s)});if(i(e.insertedTexts).length>0)return null;let n=i(e.propsChanges);if(0===n.length)return null;let s=A(n[0].properties),r=A(n.at(-1).newProperties);if(a(s,r))return null;let l={},g={};for(let e of Object.keys(r))a(s[e],r[e])||(l[e]=s[e],g[e]=r[e]);for(let e of Object.keys(s))void 0===r[e]&&(l[e]=s[e],g[e]=void 0);return{newProperties:g,properties:l,range:t}});for(let e of t)e.unref();return n.filter(Boolean)},A=e=>{let t={};return Object.keys(e).forEach(i=>{void 0!==e[i]&&(t[i]=e[i])}),t},S=(e,t)=>{e.recordingOperations=!1,t(),e.recordingOperations=!0};var O=class{charToNode(e){let t=this._mappedNodes.find(t=>{let[i,n]=t;return n===e});if(!t)throw Error("No node found for char ".concat(e));return t[0]}nodesToString(e){return e.map(this.nodeToChar.bind(this)).join("")}nodeToChar(e){for(let[t,i]of this._mappedNodes)if(a(t,e))return i;let t=this._charGenerator.next().value;return this._mappedNodes.push([e,t]),t}stringToNodes(e){return e.split("").map(this.charToNode.bind(this))}constructor(){this._charGenerator=y(),this._mappedNodes=[]}};let B=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,[a={}]=[i],{elementsAreRelated:g,getDeleteProps:u=Q,getInsertProps:d=C,getUpdateProps:c=P,ignoreProps:p,isInline:_=()=>!1}=a,b=(0,r._)(a,["elementsAreRelated","getDeleteProps","getInsertProps","getUpdateProps","ignoreProps","isInline"]),N=new O,T=N.nodesToString(e),I=N.nodesToString(t);return function(e,t){let{stringCharMapping:i}=t,a=(0,r._)(t,["stringCharMapping"]),{getDeleteProps:g,getInsertProps:u,ignoreProps:d,isInline:c}=a,p=0,_=[],b=[],N=[],T=()=>{_.push(...N,...b),b=[],N=[]},I=e=>b.push((0,n._)({},e,u(e))),E=e=>N.push((0,n._)({},e,g(e))),A=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];T(),_.push(...t)},S=e=>e.every(e=>o.Qg.isText(e)||c(e));for(;p<e.length;){let t=e[p],g=t[0],u=t[1],c=i.stringToNodes(u);switch(g){case 0:A(...c),p+=1;continue;case -1:if(p<e.length-1&&1===e[p+1][0]){let t=e[p+1][1],g=i.stringToNodes(t);if(f(c,g,{ignoreDeep:d})){A(...g),p+=2;continue}if(S(c)&&S(g)){A(...function(e,t,i){if(0===e.length)throw Error("must have at least one nodes");if(0===t.length)throw Error("must have at least one nextNodes");if(1===e.length&&1===t.length&&!o.Qg.isText(e[0])&&!o.Qg.isText(t[0])&&i.isInline(e[0])&&i.isInline(t[0])){let o=e[0],l=t[0];if(o.type===l.type&&o.children&&l.children){let{children:e}=o,t=(0,r._)(o,["children"]),{children:a}=l;if(f(t,(0,r._)(l,["children"]),{ignoreDeep:i.ignoreProps})){let e=B(o.children,l.children,i);return[(0,s._)((0,n._)({},l),{children:e})]}}}let{lineBreakChar:a}=i,g=void 0!==a,u=y({skipChars:e.concat(t).filter(o.Qg.isText).map(e=>e.text).join("")}),d=g?u.next().value:void 0,c=g?u.next().value:void 0,p=new x({charGenerator:u}),h=e.map(e=>p.nodeToText(e)),_=t.map(e=>p.nodeToText(e)),b=((e,t)=>{e.propsChanges=[],e.insertedTexts=[],e.removedTexts=[],e.recordingOperations=!0;let{apply:i}=e;return e.apply=t=>k(e,i,t),e.tf.apply=e.apply,e.commitChangesToDiffs=()=>w(e,t),e})((0,o.ie)(),i);b.children=[{children:h,type:l.t.p}],b.tf.withoutNormalizing(()=>{let e=h[0];if(h.length>1)for(let t=1;t<h.length;t++)b.tf.apply({path:[0,1],position:0,properties:{},type:"merge_node"}),e=(0,s._)((0,n._)({},e),{text:e.text+h[t].text});for(let t of function(e,t,i){var s;if(0===t.length)return[{node:e,path:[0,0],type:"remove_node"}];let r="";for(let{text:e}of t)r+=e;let l=e.text,a=[];if(r!==l)for(let e of function(e,t,i){let{deletedLineBreakChar:n,insertedLineBreakChar:s}=i,r=m.diff_main(e,t);m.diff_cleanupSemantic(r);let o=[],l=0,a=0;for(;a<r.length;){let e=r[a],t=e[0],i=e[1];switch(t){case -1:o.push({offset:l,text:void 0===n?i:i.replaceAll("\n",n),type:"remove_text"});break;case 0:l+=i.length;break;case 1:o.push({offset:l,text:void 0===s?i:i.replaceAll("\n",s),type:"insert_text"}),l+=i.length}a+=1}return o}(l,r,i))a.push((0,n._)({path:[0,0]},e));let g=v(t[0],e);(null==(s=g)?0:Object.keys(s).length)>0&&a.push({newProperties:g,path:[0,0],properties:v(e),type:"set_node"});let u=v(t[0]),d=[0,0];for(let e=0;e<t.length-1;e++){let i=t[e],n=t[e+1],s=v(n);Object.keys(u).forEach(e=>{Object.hasOwn(s,e)||(s[e]=void 0)}),a.push({path:d,position:i.text.length,properties:s,type:"split_node"}),d=o.s2.next(d),u=v(n)}return a}(e,_,{deletedLineBreakChar:c,insertedLineBreakChar:d}))b.tf.apply(t);b.commitChangesToDiffs()});let N=b.children[0].children;return g&&(N=N.map(e=>(0,s._)((0,n._)({},e),{text:e.text.replaceAll(d,"".concat(a,"\n")).replaceAll(c,a)}))),N.flatMap(e=>p.textToNode(e))}(c,g,a)),p+=2;continue}(function(e,t,i){let n,{elementsAreRelated:s,ignoreProps:r}=i,l=[],a=[...t];return e.forEach(e=>{let t=!1,i=!1;(n=a.find(n=>{var l,a,g,u,d,c;if(o.$7.isElement(e)&&o.$7.isElement(n)){let t=null!=(l=null==s?void 0:s(e,n))?l:null;if(null!==t)return t}return a=e,g=n,u=r,t=o.$7.isElement(a)&&o.$7.isElement(g)&&null!==a.children&&null!==g.children&&f(a,g,{ignoreDeep:u,ignoreShallow:["children"]}),d=e,c=n,(i=!!(o.$7.isElement(d)&&o.$7.isElement(c)&&f(d.children,c.children))||o.Qg.isText(d)&&o.Qg.isText(c)&&f(d.text,c.text))||t}))&&(a.splice(0,a.indexOf(n)).forEach(e=>{l.push({insert:!0,originNode:e})}),a.splice(0,1)),l.push({childrenUpdated:t,delete:!n,nodeUpdated:i,originNode:e,relatedNode:n})}),a.forEach(e=>{l.push({insert:!0,originNode:e})}),l})(c,g,a).forEach(e=>{if(e.delete&&E(e.originNode),e.insert&&I(e.originNode),e.relatedNode){let t=function(e,t,i){for(let n of h){let s=n(e,t,i);if(s)return s}return!1}(e.originNode,e.relatedNode,a);t?A(...t):(E(e.originNode),I(e.relatedNode))}}),p+=2;continue}for(let e of c)E(e);p+=1;continue;case 1:for(let e of c)I(e);p+=1;continue}}return T(),_}(m.diff_main(T,I),(0,n._)({elementsAreRelated:g,getDeleteProps:u,getInsertProps:d,ignoreProps:p,isInline:_,stringCharMapping:N,getUpdateProps:(e,t,i)=>p&&Object.keys(i).every(e=>p.includes(e))?{}:c(e,t,i)},b))},C=()=>({diff:!0,diffOperation:{type:"insert"}}),Q=()=>({diff:!0,diffOperation:{type:"delete"}}),P=(e,t,i)=>({diff:!0,diffOperation:{newProperties:i,properties:t,type:"update"}}),$=e=>{let{api:{getFragment:t}}=e;return{api:{getFragment(){let e=c(t()),i=e=>{"diff"in e&&(e.diff=void 0),"diffOperation"in e&&(e.diffOperation=void 0),"children"in e&&e.children.forEach(i)};return e.forEach(i),e}}}}}}]);